<!-- header (partials/header.html) -->
<header class="site-header" style="background:#fff; border-bottom:1px solid #eee; position:relative; z-index:30;">
  <div class="container" style="max-width:1100px; margin:0 auto; padding:10px 16px; display:flex; flex-direction:column; gap:8px;">
    <!-- 1行目：タイトル -->
    <div style="display:flex; align-items:center; gap:10px;">
      <a href="/" style="display:flex; align-items:center; gap:8px; text-decoration:none;">
        <img src="/icon-512.png" alt="nihongotext logo" style="width:28px; height:28px; border-radius:6px;" />
        <span style="font-weight:700; font-size:20px; color:#e6462d;">nihongotext<span style="color:#333;">.com</span></span>
      </a>
    </div>

    <!-- 2行目：ナビ -->
    <nav aria-label="Main navigation" style="display:flex; align-items:center; gap:14px; flex-wrap:wrap;">
      <a href="/" style="color:#333; text-decoration:none;">Home</a>
      <a href="/blog/index.html" style="color:#333; text-decoration:none;">Blog</a>
      <a href="/inquiry/index.html" style="color:#333; text-decoration:none;">Inquiry</a>
      <a href="/legal.html" style="color:#333; text-decoration:none;">Legal</a>
      <a href="/privacy.html" style="color:#333; text-decoration:none;">Privacy</a>

      <!-- Learning（常に開けるフォールバック付き） -->
      <button
        id="learnBtn"
        type="button"
        title="Learning list"
        style="margin-left:8px; padding:6px 10px; border:1px solid #ddd; background:#fff; border-radius:8px; cursor:pointer; display:inline-flex; align-items:center; gap:6px;"
        onclick="(window._ntxOpenLearning ? window._ntxOpenLearning() : (function(){var o=document.getElementById('learning-overlay'), d=document.getElementById('learning-drawer'); if(o&&d){o.style.display='block'; setTimeout(function(){d.style.right='0';},10);} })())"
      >
        <i class="fa-solid fa-book-open" style="color:#e6462d;"></i>
        <span>Learning</span>
        <span id="learning-count-badge" style="min-width:18px; height:18px; padding:0 6px; border-radius:9px; background:#e6462d; color:#fff; font-size:12px; display:inline-flex; align-items:center; justify-content:center;">0</span>
      </button>
    </nav>

    <!-- 3行目：アイコン（赤） -->
    <nav aria-label="Header icons" style="display:flex; align-items:center; gap:14px; font-size:20px;">
      <a href="https://x.com/nihongotext" target="_blank" rel="noopener" title="X (Twitter)" aria-label="X (Twitter)" style="color:#e6462d;">
        <i class="fa-brands fa-x-twitter"></i>
      </a>
      <a href="https://www.reddit.com/user/nihongotext" target="_blank" rel="noopener" title="Reddit" aria-label="Reddit" style="color:#e6462d;">
        <i class="fa-brands fa-reddit-alien"></i>
      </a>
      <a href="https://medium.com/@nihongotext" target="_blank" rel="noopener" title="Medium" aria-label="Medium" style="color:#e6462d;">
        <i class="fa-brands fa-medium"></i>
      </a>
      <a href="https://ko-fi.com/nihongotext" target="_blank" rel="noopener" title="Ko-fi" aria-label="Ko-fi" style="color:#e6462d;">
        <i class="fa-solid fa-mug-hot"></i>
      </a>
      <a href="https://nihongotext.substack.com/" target="_blank" rel="noopener" title="Substack" aria-label="Substack" style="color:#e6462d;">
        <i class="fa-solid fa-newspaper"></i>
      </a>
      <!-- Policy icons -->
      <a href="/privacy.html" title="Privacy Policy" aria-label="Privacy Policy" style="color:#e6462d;">
        <i class="fa-solid fa-user-shield"></i>
      </a>
      <a href="/legal.html" title="Legal Notice" aria-label="Legal Notice" style="color:#e6462d;">
        <i class="fa-solid fa-scale-balanced"></i>
      </a>
    </nav>
  </div>

  <!-- Overlay + Drawer（スクリプトが無くても閉じられるフォールバック付き） -->
  <div id="learning-overlay" style="position:fixed; inset:0; background:rgba(0,0,0,0.35); display:none; z-index:40;"></div>

  <aside id="learning-drawer" style="position:fixed; top:0; right:-560px; width:560px; max-width:96vw; height:100%; background:#fff; box-shadow:-12px 0 24px rgba(0,0,0,0.12); z-index:50; display:flex; flex-direction:column; transition:right .25s ease;">
    <!-- ヘッダー -->
    <div style="display:flex; justify-content:space-between; padding:14px 16px; border-bottom:1px solid #eee;">
      <h2 style="margin:0; font-size:18px; display:flex; align-items:center; gap:8px;">
        <i class="fa-solid fa-book-open" style="color:#e6462d;"></i> Learning
        <span id="learning-count" style="color:#666; font-size:13px;"></span>
      </h2>
      <button id="btn-close-learning"
        style="border:1px solid #ddd; background:#fff; border-radius:8px; padding:6px 10px; cursor:pointer;"
        title="Close"
        onclick="(window._ntxCloseLearning ? window._ntxCloseLearning() : (function(){var o=document.getElementById('learning-overlay'), d=document.getElementById('learning-drawer'); if(o&&d){ d.style.right='-560px'; setTimeout(function(){ o.style.display='none'; },250);} })())">
        <i class="fa-solid fa-xmark"></i>
      </button>
    </div>

    <!-- 本文 -->
    <div id="learning-content" style="padding:12px 16px; overflow:auto; flex:1;">
      <!-- ここへ単語＋例文を描画 -->
      <div id="learning-list"></div>

      <!-- Quiz placeholder -->
      <section style="margin-top:18px; border-top:1px dashed #eee; padding-top:12px;">
        <h3 style="font-size:16px; margin:0 0 8px;">
          <i class="fa-solid fa-circle-question" style="color:#e6462d;"></i> Quiz (coming soon)
        </h3>
        <p style="margin:0; color:#666;">You will be able to test the items currently in Learning here.</p>
      </section>
    </div>

    <!-- フッター操作 -->
    <div style="padding:12px 16px; border-top:1px solid #eee; display:flex; justify-content:space-between; gap:8px;">
      <button title="Clear Learning list"
        style="padding:8px 12px; border:1px solid #ddd; background:#fff; border-radius:8px; cursor:pointer;"
        onclick="(function(){ try{ localStorage.setItem('nihongo_learning','[]'); localStorage.setItem('ntx_learning_v2','[]'); localStorage.setItem('nihongo_learned', JSON.stringify(JSON.parse(localStorage.getItem('nihongo_learned')||'[]'))); }catch(_){};
          var b=document.getElementById('learning-count-badge'); if(b) b.textContent='0';
          var l=document.getElementById('learning-list'); if(l) l.innerHTML='<p style=&quot;color:#666;&quot;>No items in Learning yet. Use the <em>Learn</em> button on words to add them here.</p>';
          var c=document.getElementById('learning-count'); if(c) c.textContent='(0)';
        })()">
        <i class="fa-solid fa-trash-can" style="color:#e6462d;"></i> Clear
      </button>
      <button title="Export Learning (JSON)"
        style="padding:8px 12px; border:1px solid #ddd; background:#fff; border-radius:8px; cursor:pointer;"
        onclick="(function(){ var data=[]; try{ data = JSON.parse(localStorage.getItem('nihongo_learning')||'[]'); }catch(_){}
          try{ var alt = JSON.parse(localStorage.getItem('ntx_learning_v2')||'[]'); if(Array.isArray(alt)) data = data.concat(alt); }catch(_){}
          var seen=new Set(); data=data.filter(function(x){ if(!x||!x.id) return false; var k=String(x.id); if(seen.has(k)) return false; seen.add(k); return true; });
          var blob=new Blob([JSON.stringify(data,null,2)],{type:'application/json'}); var url=URL.createObjectURL(blob);
          var a=document.createElement('a'); a.href=url; a.download='learning.json'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url); })()">
        <i class="fa-solid fa-file-arrow-down" style="color:#e6462d;"></i> Export
      </button>
    </div>
  </aside>
</header>
