<!-- /partials/header.html -->
<header class="site-header" style="background:#fff;border-bottom:1px solid #eee;position:relative;z-index:30;">
  <div class="container"
       style="max-width:1100px;margin:0 auto;padding:14px 16px;display:flex;flex-direction:column;gap:10px;align-items:center;text-align:center;">
    <!-- 1行目：タイトル -->
    <div>
      <a href="/" style="display:inline-flex;align-items:center;gap:8px;text-decoration:none;">
        <img src="/icon-512.png" alt="nihongotext logo" style="width:40px;height:40px;border-radius:8px;" />
        <span style="font-weight:900;font-size:40px;line-height:1;color:#e6462d;">
          nihongotext<span style="color:#222;">.com</span>
        </span>
      </a>
      <!-- 2行目：== bata version ==（20px） -->
      <div style="font-size:20px;line-height:1.2;color:#98a1a8;margin-top:6px;">== beta version ==</div>
    </div>

    <!-- 3行目：Learning / Learned -->
    <nav aria-label="Learning navigation"
         style="display:flex;align-items:center;justify-content:center;gap:10px;flex-wrap:wrap;margin-top:6px;">
      <button type="button"
        style="padding:8px 12px;border:1px solid #e6462d;background:#fff;border-radius:10px;cursor:pointer;display:inline-flex;align-items:center;gap:8px;font-weight:700;color:#e6462d;"
        onclick="(window.openLearning?window.openLearning(): (function(){var o=document.getElementById('learningModal');if(o){o.classList.add('show');} })())">
        <i class="fa-solid fa-book-open"></i>
        <span>Learning</span>
        <span id="badge-learning"
              style="min-width:20px;height:20px;padding:0 8px;border-radius:10px;background:#e6462d;color:#fff;font-size:12px;display:inline-flex;align-items:center;justify-content:center;">0</span>
      </button>

      <button type="button"
        style="padding:8px 12px;border:1px solid #e6462d;background:#fff;border-radius:10px;cursor:pointer;display:inline-flex;align-items:center;gap:8px;font-weight:700;color:#e6462d;"
        onclick="(window.openLearned?window.openLearned(): (function(){var o=document.getElementById('learnedModal');if(o){o.classList.add('show');} })())">
        <i class="fa-solid fa-graduation-cap"></i>
        <span>Learned</span>
        <span id="badge-learned"
              style="min-width:20px;height:20px;padding:0 8px;border-radius:10px;background:#e6462d;color:#fff;font-size:12px;display:inline-flex;align-items:center;justify-content:center;">0</span>
      </button>
    </nav>

    <!-- 4行目：ナビ -->
    <nav aria-label="Main navigation"
         style="display:flex;align-items:center;justify-content:center;gap:16px;flex-wrap:wrap;">
      <a href="/blog/index.html" style="color:#333;text-decoration:none;">Blog</a>
      <a href="/inquiry/index.html" style="color:#333;text-decoration:none;">Inquiry</a>
      <a href="/legal.html" style="color:#333;text-decoration:none;">Legal</a>
      <a href="/privacy.html" style="color:#333;text-decoration:none;">Privacy</a>
    </nav>

    <!-- 5行目：アイコン -->
    <nav aria-label="Header icons"
         style="display:flex;align-items:center;justify-content:center;gap:16px;font-size:20px;">
      <a href="https://x.com/nihongotext" target="_blank" rel="noopener" title="X" style="color:#e6462d;"><i class="fa-brands fa-x-twitter"></i></a>
      <a href="https://www.reddit.com/user/nihongotext" target="_blank" rel="noopener" title="Reddit" style="color:#e6462d;"><i class="fa-brands fa-reddit-alien"></i></a>
      <a href="https://medium.com/@nihongotext" target="_blank" rel="noopener" title="Medium" style="color:#e6462d;"><i class="fa-brands fa-medium"></i></a>
      <a href="https://ko-fi.com/nihongotext" target="_blank" rel="noopener" title="Ko-fi" style="color:#e6462d;"><i class="fa-solid fa-mug-hot"></i></a>
      <a href="https://nihongotext.substack.com/" target="_blank" rel="noopener" title="Substack" style="color:#e6462d;"><i class="fa-solid fa-newspaper"></i></a>
     <!--
      <a href="/privacy.html" title="Privacy Policy" style="color:#e6462d;"><i class="fa-solid fa-user-shield"></i></a>
      <a href="/legal.html" title="Legal" style="color:#e6462d;"><i class="fa-solid fa-scale-balanced"></i></a>
     -->
    </nav>
  </div>

  <!-- オーバーレイ（モーダル用 / index.html 側のモーダルを使用） -->
  <div id="learning-overlay" style="position:fixed;inset:0;background:rgba(0,0,0,.35);display:none;z-index:40;"></div>

  <!-- バッジ更新 & フォールバック起動スクリプト -->
  <script>
    (function(){
      // Learning バッジ：/index.html 側の LEARN_KEY と同じキーを参照
      var LEARN_KEY = 'ntx_learning_v2';
      function countLearning(){
        try{ var a = JSON.parse(localStorage.getItem(LEARN_KEY) || '[]'); return Array.isArray(a) ? a.length : 0; }
        catch(_){ return 0; }
      }
      function countLearned(){
        var n = 0; try{
          for (var i=0;i<localStorage.length;i++){
            var k = localStorage.key(i);
            if(k && k.indexOf('nt_learned_')===0){
              var arr = JSON.parse(localStorage.getItem(k) || '[]');
              if(Array.isArray(arr)) n += arr.length;
            }
          }
        }catch(_){}
        return n;
      }
      function paint(){
        var bl = document.getElementById('badge-learning');
        var bd = document.getElementById('badge-learned');
        if(bl) bl.textContent = countLearning();
        if(bd) bd.textContent = countLearned();
      }
      // 初回 & storage 変化で更新
      paint();
      window.addEventListener('storage', function(e){
        if(!e || !e.key) return;
        if(e.key===LEARN_KEY || e.key.indexOf('nt_learned_')===0) paint();
      });

      // 旧フォールバックで開く場合に備えて公開関数が無い時の簡易関数
      if(!window._ntxOpenLearning){
        window._ntxOpenLearning = function(){
          if (window.openLearning) return window.openLearning();
          var m = document.getElementById('learningModal');
          if(m) m.classList.add('show');
        };
      }
      if(!window._ntxOpenLearned){
        window._ntxOpenLearned = function(){
          if (window.openLearned) return window.openLearned();
          var m = document.getElementById('learnedModal');
          if(m) m.classList.add('show');
        };
      }
    })();
  </script>
</header>
