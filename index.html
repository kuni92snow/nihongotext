<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>JLPT Words | nihongotext.com</title>
<base href="/" />
<link rel="icon" href="/favicon.ico" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
<style>
body { font-family: system-ui, sans-serif; margin:0; background:#fff; color:#333; }
.container { max-width:1100px; margin:0 auto; padding:20px; }
.word-card { border:1px solid #eee; border-radius:12px; padding:16px; margin-bottom:16px; background:#fff; }
.word-header { display:flex; justify-content:space-between; align-items:center; }
.word-buttons button { border:1px solid #ddd; border-radius:8px; background:#fff; cursor:pointer; padding:4px 8px; margin-left:4px; }
.word-buttons button:hover { background:#f8f8f8; }
.examples { margin-top:8px; padding-left:12px; }
.example { margin-bottom:6px; }
.toggle-btn { cursor:pointer; color:#e6462d; font-size:14px; }
.pagination { display:flex; justify-content:center; gap:8px; margin-top:20px; }
.pagination button { border:1px solid #ddd; border-radius:6px; padding:4px 10px; background:#fff; cursor:pointer; }
.pagination button.active { background:#e6462d; color:#fff; border-color:#e6462d; }
#display-options { display:flex; gap:12px; margin-bottom:16px; align-items:center; }
label { font-size:14px; }
</style>
</head>

<body>
  <!-- 共通ヘッダー -->
  <div id="header-placeholder"></div>

  <main class="container">
    <h1 id="page-title">JLPT — Words</h1>

    <!-- 表示切替 -->
    <div id="display-options">
      <label><input type="checkbox" id="show-ja" checked> 日本語</label>
      <label><input type="checkbox" id="show-kana" checked> ひらがな</label>
      <label><input type="checkbox" id="show-ro" checked> ローマ字</label>
      <label><input type="checkbox" id="show-en" checked> 英語</label>
    </div>

    <div id="word-list"></div>
    <div class="pagination" id="pagination"></div>
  </main>

  <!-- 共通フッター -->
  <div id="footer-placeholder"></div>

  <script>
  // ===== ヘッダー・フッター読み込み =====
  Promise.all([
    fetch('/partials/header.html').then(r=>r.text()),
    fetch('/partials/footer.html').then(r=>r.text())
  ]).then(([h,f])=>{
    document.getElementById('header-placeholder').innerHTML=h;
    document.getElementById('footer-placeholder').innerHTML=f;
  });

  // ===== 設定 =====
  const PAGE_SIZE = 5;
  let DATA = [];
  let CURRENT_PAGE = 1;
  const params = new URLSearchParams(location.search);
  const level = params.get('level') || 'N5';
  const part = params.get('part') || 'verbs';
  const DATA_URL = `/data/json/${level}/${part}.json`;

  // ===== JSONロード =====
  async function loadData() {
    try {
      const res = await fetch(DATA_URL);
      DATA = await res.json();
      renderPage();
    } catch(e) {
      document.getElementById('word-list').innerHTML = `<p style="color:red;">Failed to load dataset: ${DATA_URL}</p>`;
      console.error(e);
    }
  }

  // ===== レンダリング =====
  function renderPage() {
    const start = (CURRENT_PAGE-1)*PAGE_SIZE;
    const end = start+PAGE_SIZE;
    const visible = DATA.slice(start,end);

    const showJa = document.getElementById('show-ja').checked;
    const showKana = document.getElementById('show-kana').checked;
    const showRo = document.getElementById('show-ro').checked;
    const showEn = document.getElementById('show-en').checked;

    const html = visible.map(item=>{
      const exHtml = item.examples.map((ex,i)=>`
        <div class="example">
          ${showEn? `<div>• ${ex.en}</div>`:''}
          ${showJa? `<div>${ex.ja}</div>`:''}
          ${showKana? `<div>${ex.kana}</div>`:''}
          ${showRo? `<div>${ex.ro}</div>`:''}
        </div>
      `).join('');

      return `
      <article class="word-card">
        <div class="word-header">
          <div>
            ${showEn? `<div style="font-weight:bold;">${item.en}</div>`:''}
            ${showRo? `<div>${item.ro}</div>`:''}
            ${showKana? `<div>${item.kana}</div>`:''}
            ${showJa? `<div>${item.ja}</div>`:''}
          </div>
          <div class="word-buttons">
            <button onclick="moveToLearning('${item.id}')">Learn</button>
            <button onclick="moveToLearned('${item.id}')">Learned</button>
          </div>
        </div>
        <div>
          <span class="toggle-btn" onclick="toggleExamples(this)">▼ Show examples</span>
          <div class="examples" style="display:none;">${exHtml}</div>
        </div>
      </article>`;
    }).join('');

    document.getElementById('word-list').innerHTML = html;
    renderPagination();
  }

  function renderPagination() {
    const total = Math.ceil(DATA.length / PAGE_SIZE);
    let html = '';
    for(let i=1;i<=total;i++){
      html += `<button class="${i===CURRENT_PAGE?'active':''}" onclick="gotoPage(${i})">${i}</button>`;
    }
    document.getElementById('pagination').innerHTML = html;
  }

  function gotoPage(p){ CURRENT_PAGE=p; renderPage(); }

  // ===== 例文開閉 =====
  function toggleExamples(el){
    const ex = el.nextElementSibling;
    if(ex.style.display==='none'){ ex.style.display='block'; el.textContent='▲ Hide examples'; }
    else{ ex.style.display='none'; el.textContent='▼ Show examples'; }
  }

  // ===== LocalStorage操作 =====
  function moveToLearning(id){
    const list = JSON.parse(localStorage.getItem('nihongo_learning')||'[]');
    if(!list.includes(id)) list.push(id);
    localStorage.setItem('nihongo_learning',JSON.stringify(list));
    alert('Added to Learning.');
  }
  function moveToLearned(id){
    const list = JSON.parse(localStorage.getItem('nihongo_learned')||'[]');
    if(!list.includes(id)) list.push(id);
    localStorage.setItem('nihongo_learned',JSON.stringify(list));
    alert('Moved to Learned.');
  }

  // ===== チェックボックス再描画 =====
  document.addEventListener('change', e=>{
    if(['show-ja','show-kana','show-ro','show-en'].includes(e.target.id)) renderPage();
  });

  loadData();
  </script>
</body>
</html>
