<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Inquiry | nihongotext.com</title>

  <link rel="icon" href="/favicon.ico" />
  <link rel="icon" type="image/png" href="/icon-512.png" sizes="512x512">
  <link rel="apple-touch-icon" href="/icon-512.png" sizes="512x512">
  <link rel="manifest" href="/manifest.webmanifest">
  <meta name="theme-color" content="#b22222">

  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">

  <!-- GA4 -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-9QSHWJE0HZ"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-9QSHWJE0HZ', { send_page_view:false });
  </script>

  <style>
    :root{
      --shu:#e6462d;
      --shu-tint:#fff2ef;
      --ink:#1f2937;
      --muted:#6b7280;
      --line:#e5e7eb;
      --card:#fff7f6;
    }
    *{box-sizing:border-box}
    html,body{
      margin:0;
      background:#fff;
      color:var(--ink);
      font:16px/1.65 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Noto Sans JP","Hiragino Kaku Gothic ProN","Yu Gothic UI","Meiryo",sans-serif;
    }
    a{color:inherit;text-decoration:none}
    button{cursor:pointer}

    .wrap{max-width:900px;margin:0 auto;padding:0 16px}

    .topbar{border-top:4px solid var(--shu);border-bottom:1px solid var(--shu-tint);background:#fff}

    main{padding:18px 0 32px}

    h1{
      font-size:24px;
      margin:0 0 12px;
      display:flex;
      align-items:center;
      gap:8px;
    }
    h1 i{color:var(--shu);}
    .lead{color:var(--muted);font-size:14px;margin-bottom:18px;}

    .card{
      background:#fff;
      border-radius:14px;
      border:1px solid #f1cbc6;
      padding:16px 18px 20px;
      box-shadow:0 4px 10px rgba(0,0,0,.03);
    }

    .row{margin-bottom:12px;}
    label{
      display:block;
      font-weight:600;
      margin-bottom:4px;
    }
    .req{
      color:var(--shu);
      font-weight:700;
      margin-left:4px;
    }

    input[type="text"],
    input[type="email"],
    textarea{
      width:100%;
      border-radius:10px;
      border:1px solid var(--line);
      padding:8px 10px;
      font:inherit;
      resize:vertical;
    }

    textarea{min-height:120px;}

    .small-note{
      font-size:12px;
      color:var(--muted);
      margin-top:4px;
    }

    .btn-row{
      display:flex;
      gap:10px;
      justify-content:flex-end;
      margin-top:16px;
    }
    .btn{
      border-radius:10px;
      padding:8px 16px;
      border:1px solid var(--shu);
      font-weight:700;
      background:#fff;
      color:var(--shu);
    }
    .btn-primary{
      background:var(--shu);
      color:#fff;
    }

    .msg{
      margin-top:12px;
      font-size:14px;
    }
    .msg.ok{color:#16a34a;}
    .msg.ng{color:#b91c1c;}

    .recap-wrap{
      margin-top:12px;
      margin-bottom:4px;
    }

    @media (max-width:600px){
      h1{font-size:20px;}
      .card{padding:12px 12px 16px;}
    }
  </style>
</head>
<body>
  <!-- Header: partials.js がここに挿入 -->
  <div class="topbar">
    <div id="site-header" class="wrap" aria-label="Site header">
      <!-- assets/partials.js がヘッダーを注入 -->
    </div>
  </div>

  <main class="wrap">
    <h1>
      <i class="fa-solid fa-envelope-open-text"></i>
      <span id="inq-title">Inquiry / Contact</span>
    </h1>
    <p class="lead" id="inq-lead">
      Please feel free to ask any questions or send feedback about nihongotext.com.
    </p>

    <section class="card" aria-label="Inquiry form">
      <form id="inq-form" method="post" action="https://script.google.com/macros/s/AKfycbwOZYS2HD-rvYVGFMkKsgm0feGWxgFypjpPbhVE8LYgKJe1T3lXfkgDNAiKIjJZcZNdNA/exec">
        <div class="row">
          <label for="name">
            <span id="lb-name">Name</span><span class="req">*</span>
          </label>
          <input id="name" name="name" type="text" autocomplete="name" required />
        </div>

        <div class="row">
          <label for="email">
            <span id="lb-email">Email</span><span class="req">*</span>
          </label>
          <input id="email" name="email" type="email" autocomplete="email" required />
          <div class="small-note" id="note-email">
            We will only use your email address to reply to your inquiry.
          </div>
        </div>

        <div class="row">
          <label for="subject">
            <span id="lb-subject">Subject</span><span class="req">*</span>
          </label>
          <input id="subject" name="subject" type="text" required />
        </div>

        <div class="row">
          <label for="message">
            <span id="lb-message">Message</span><span class="req">*</span>
          </label>
          <textarea id="message" name="message" required></textarea>
          <div class="small-note" id="note-message">
            You can write in English or Japanese.
          </div>
        </div>

        <!-- reCAPTCHA v2 -->
        <div class="recap-wrap">
          <div class="g-recaptcha" data-sitekey="6Le4Kv8qAAAAAE7t-PbJ3Wf1R0C5ud6Z6fM8S0aG"></div>
        </div>

        <div class="btn-row">
          <button type="reset" class="btn" id="btn-cancel">Cancel</button>
          <button type="submit" class="btn btn-primary" id="btn-send">Send</button>
        </div>

        <div id="msg-area" class="msg" aria-live="polite"></div>
      </form>
    </section>
  </main>

  <!-- Footer: partials.js がここに挿入 -->
  <div id="site-footer" class="wrap" aria-label="Site footer">
    <!-- assets/partials.js がフッターを注入 -->
  </div>

  <!-- reCAPTCHA v2 -->
  <script src="https://www.google.com/recaptcha/api.js" async defer></script>

  <!-- 共通ヘッダー / フッター -->
  <script src="/assets/partials.js"></script>

  <script>
    /* ========= 多言語テキスト定義 ========= */
    const dict = {
      en: {
        contact: 'Inquiry / Contact',
        lead: 'Please feel free to ask any questions or send feedback about nihongotext.com.',
        name: 'Name',
        email: 'Email',
        subject: 'Subject',
        message: 'Message',
        cancel: 'Clear',
        send: 'Send',
        noteEmail: 'We will only use your email address to reply to your inquiry.',
        noteMsg: 'You can write in English or Japanese.',
        placeholders: {
          name: 'Your name',
          email: 'your@email.com',
          subject: 'About the site, features, or requests',
          message: 'Please write your question or comment here.'
        },
        msgSent: 'Your message has been sent. Thank you!',
        msgError: 'Failed to send your message. Please try again later.',
        msgRecap: 'Please complete the reCAPTCHA verification.'
      },
      ja: {
        contact: 'お問い合わせ',
        lead: 'nihongotext.com に関するご質問・ご要望・不具合報告などがありましたら、こちらからお送りください。',
        name: 'お名前',
        email: 'メールアドレス',
        subject: '件名',
        message: 'お問い合わせ内容',
        cancel: 'クリア',
        send: '送信',
        noteEmail: 'ご入力いただいたメールアドレスは、返信のためのみに使用します。',
        noteMsg: '日本語または英語でご記入ください。',
        placeholders: {
          name: 'お名前を入力してください',
          email: 'example@example.com',
          subject: 'サイトや機能、ご要望など',
          message: 'お問い合わせ内容をご記入ください。'
        },
        msgSent: '送信が完了しました。お問い合わせありがとうございます。',
        msgError: '送信に失敗しました。しばらくしてから再度お試しください。',
        msgRecap: 'reCAPTCHA の確認を完了してください。'
      }
    };

    /* ========= 言語状態 ========= */
    let lang = (function(){
      try{
        return localStorage.getItem('nt_lang') || 'en';
      }catch(_){
        return 'en';
      }
    })();

    const els = {
      title:   document.getElementById('inq-title'),
      lead:    document.getElementById('inq-lead'),
      lbName:  document.getElementById('lb-name'),
      lbEmail: document.getElementById('lb-email'),
      lbSubject: document.getElementById('lb-subject'),
      lbMessage: document.getElementById('lb-message'),
      name:    document.getElementById('name'),
      email:   document.getElementById('email'),
      subject: document.getElementById('subject'),
      message: document.getElementById('message'),
      noteEmail:   document.getElementById('note-email'),
      noteMessage: document.getElementById('note-message'),
      btnCancel:   document.getElementById('btn-cancel'),
      btnSend:     document.getElementById('btn-send'),
      msg:         document.getElementById('msg-area')
    };

    /* ========= 言語適用（★修正版） ========= */
    function applyLang(nextLang){
      // ヘッダーのトグルから呼ばれた場合はその言語を優先
      if (nextLang) {
        lang = nextLang;
      } else {
        try {
          lang = localStorage.getItem('nt_lang') || lang || 'en';
        } catch (_) {
          lang = lang || 'en';
        }
      }

      const t = dict[lang] || dict.en;

      els.title.innerHTML = t.contact;
      els.lead.textContent = t.lead;

      els.lbName.innerHTML = t.name;
      els.lbEmail.innerHTML = t.email;
      els.lbSubject.innerHTML = t.subject;
      els.lbMessage.innerHTML = t.message;

      els.btnCancel.textContent = t.cancel;
      els.btnSend.textContent = t.send;

      els.noteEmail.textContent = t.noteEmail;
      els.noteMessage.textContent = t.noteMsg;

      els.name.placeholder    = t.placeholders.name;
      els.email.placeholder   = t.placeholders.email;
      els.subject.placeholder = t.placeholders.subject;
      els.message.placeholder = t.placeholders.message;

      try{
        localStorage.setItem('nt_lang', lang);
      }catch(_){}
    }

    // 初期適用
    applyLang();

    /* ========= フォーム送信(JSONP) ========= */
    (function(){
      const form = document.getElementById('inq-form');
      const msg  = els.msg;
      if(!form || !msg) return;

      function setMsg(text, ok){
        msg.textContent = text;
        msg.className = 'msg ' + (ok ? 'ok' : 'ng');
      }

      form.addEventListener('submit', function(ev){
        ev.preventDefault();

        if(window.grecaptcha){
          const token = grecaptcha.getResponse();
          if(!token){
            const t = dict[lang] || dict.en;
            setMsg(t.msgRecap, false);
            return;
          }
        }

        const data = new FormData(form);
        data.append('lang', lang);

        const params = new URLSearchParams();
        for(const [k,v] of data.entries()){
          params.append(k,v);
        }
        params.append('callback','handleInqResp');

        const url = form.action + '?' + params.toString();
        const script = document.createElement('script');
        script.src = url;
        script.onerror = function(){
          const t = dict[lang] || dict.en;
          setMsg(t.msgError,false);
        };
        document.body.appendChild(script);
      });

      window.handleInqResp = function(res){
        const t = dict[lang] || dict.en;
        if(res && res.status === 'ok'){
          setMsg(t.msgSent,true);
          try{ document.getElementById('inq-form').reset(); }catch(_){}
          if(window.grecaptcha){
            try{ grecaptcha.reset(); }catch(_){}
          }
        }else{
          setMsg(t.msgError,false);
        }
      };
    })();

    /* ========= 共通ヘッダー/フッターの注入と連携 ========= */
    (function(){
      if(typeof injectPartials !== 'function'){ return; }

      injectPartials({
        hideLearningNav: true,
        titleTargets: [
          { el: document.querySelector('title'),
            en: 'Inquiry | nihongotext.com',
            ja: 'お問い合わせ | nihongotext.com'
          }
        ],
        titleDoc: {
          en: 'Inquiry | nihongotext.com',
          ja: 'お問い合わせ | nihongotext.com'
        },
        onLangApply: function(newLang){
          applyLang(newLang);
        }
      });
    })();
  </script>
</body>
</html>
