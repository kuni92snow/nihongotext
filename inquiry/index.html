<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Inquiry | nihongotext.com</title>

<!-- 基本スタイル（トップページと同系色） -->
<style>
  :root{
    --brand:#e74c3c;        /* 朱色（ヘッダーライン・ボタン） */
    --brand-weak:#fbe8e6;   /* 朱色の淡色（カード背景） */
    --text:#333;
    --border:#e6e6e6;
  }
  *{box-sizing:border-box}
  body{margin:0;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Hiragino Kaku Gothic ProN","Noto Sans JP","Yu Gothic UI",Meiryo,sans-serif;color:var(--text);background:#fff}
  a{color:var(--brand);text-decoration:none}
  a:hover{text-decoration:underline}

  /* ヘッダー */
  .site-header{
    position:sticky;top:0;z-index:50;background:#fff;border-bottom:3px solid var(--brand);
  }
  .header-inner{
    max-width:1080px;margin:0 auto;display:flex;align-items:center;gap:12px;padding:16px 12px;
  }
  .brand{font-weight:800;font-size:28px;color:var(--brand)}
  .beta{font-size:12px;opacity:.65}
  .spacer{flex:1}

  /* 言語ボタン（右端固定） */
  .lang-switch{display:flex;gap:8px;align-items:center}
  .lang-btn{
    border:1px solid var(--border);background:#fff;border-radius:999px;padding:6px 12px;font-size:13px;cursor:pointer;
  }
  .lang-btn.active{border-color:var(--brand);color:#fff;background:var(--brand)}
  .iconbar{display:flex;gap:10px;margin-left:16px}
  .iconbtn{width:28px;height:28px;border-radius:50%;border:1px solid var(--border);display:flex;align-items:center;justify-content:center;cursor:pointer}

  /* コンテナ */
  .container{max-width:900px;margin:24px auto;padding:0 12px}
  .card{
    background:var(--brand-weak);border:1px solid var(--border);border-radius:12px;padding:18px 16px;
  }
  .card h2{margin:0 0 14px;font-size:18px}

  /* フォーム */
  .row{display:flex;gap:12px;margin-bottom:10px}
  .col{flex:1}
  .input, .select, .textarea{
    width:100%;border:1px solid var(--border);border-radius:8px;padding:10px 12px;font-size:14px;background:#fff;
  }
  .textarea{min-height:160px;resize:vertical}
  .note{font-size:12px;opacity:.75;margin-top:8px}
  .actions{margin-top:16px;display:flex;gap:10px;align-items:center}
  .btn{
    background:var(--brand);color:#fff;border:none;border-radius:10px;padding:10px 16px;font-weight:700;cursor:pointer;
  }
  .btn:disabled{opacity:.55;cursor:not-allowed}
  .status{font-size:13px}

  /* フッター */
  .site-footer{border-top:2px solid var(--brand);padding:18px 0;margin-top:40px}
  .footer-inner{max-width:1080px;margin:0 auto;padding:0 12px;text-align:center;font-size:12px;opacity:.8}
  .foot-icons{display:flex;gap:10px;justify-content:center;margin-top:10px}

  /* 小さめ画面 */
  @media (max-width:640px){ .row{flex-direction:column} }
</style>
</head>
<body>

<!-- ヘッダー：ロゴ + 右端に言語ボタン -->
<header class="site-header">
  <div class="header-inner">
    <div class="brand">nihongotext<span class="beta">.com  == beta version ==</span></div>
    <div class="spacer"></div>

    <div class="lang-switch" id="langSwitch">
      <button class="lang-btn" data-lang="ja" id="btnJA">日本語</button>
      <button class="lang-btn" data-lang="en" id="btnEN">English</button>
    </div>

    <div class="iconbar" aria-hidden="true">
      <div class="iconbtn">🏠</div>
      <div class="iconbtn">🔍</div>
      <div class="iconbtn">📝</div>
      <div class="iconbtn">📧</div>
    </div>
  </div>
</header>

<main class="container">
  <section class="card">
    <h2 id="titleTxt">お問い合わせ</h2>

    <form id="inquiryForm">
      <div class="row">
        <div class="col">
          <label id="lblName" for="name">お名前</label>
          <input class="input" id="name" name="name" autocomplete="name" />
        </div>
        <div class="col">
          <label id="lblEmail" for="email">メール</label>
          <input class="input" id="email" name="email" type="email" autocomplete="email" />
        </div>
      </div>

      <div class="row">
        <div class="col">
          <label id="lblSubject" for="subject">件名</label>
          <input class="input" id="subject" name="subject" />
        </div>
        <div class="col">
          <label id="lblCategory" for="category">カテゴリ</label>
          <select class="select" id="category" name="category">
            <option value="general">一般</option>
            <option value="bug">不具合</option>
            <option value="request">機能要望</option>
            <option value="other">その他</option>
          </select>
        </div>
      </div>

      <div class="row">
        <div class="col">
          <label id="lblMessage" for="message">内容</label>
          <textarea class="textarea" id="message" name="message"></textarea>
        </div>
      </div>

      <!-- reCAPTCHA（動的に言語を切替） -->
      <div id="captchaWrap" class="row" style="margin-top:6px">
        <div class="col">
          <div id="recaptcha"></div>
          <div id="captchaErr" class="note" style="color:#c00; display:none"></div>
        </div>
      </div>

      <div class="note" id="agreeNote">
        送信すると、<a href="/privacy.html" target="_blank">プライバシーポリシー</a> と
        <a href="/terms.html" target="_blank">利用規約</a> に同意したものとみなされます。
      </div>

      <div class="actions">
        <button type="submit" class="btn" id="btnSubmit">送信</button>
        <div id="status" class="status"></div>
      </div>
    </form>
  </section>
</main>

<footer class="site-footer">
  <div class="footer-inner">
    <div class="foot-icons" aria-hidden="true">
      <div class="iconbtn">🏠</div>
      <div class="iconbtn">🔍</div>
      <div class="iconbtn">📝</div>
      <div class="iconbtn">📧</div>
    </div>
    <div style="margin-top:6px">© 2025 nihongotext.com</div>
  </div>
</footer>

<!-- ===== フロントロジック ===== -->
<script>
/* === 設定 === */
const GAS_JSONP = "https://script.google.com/macros/s/AKfycbwOZYS2HD-rvYVGFMkKsgm0feGWxgFypjpPbhVE8LYgKJe1T3lXfkgDNAiKIjJZcZNdNA/exec";
const RECAPTCHA_SITE_KEY = "6LcRKvArAAAAAFVmY21y9o_hwTszHwzp3bgRXtBV"; // ご指定 Site key

/* === i18n テキスト === */
const T = {
  ja:{
    page:"お問い合わせ", name:"お名前", email:"メール", subject:"件名", category:"カテゴリ", message:"内容",
    agree:`送信すると、<a href="/privacy.html" target="_blank">プライバシーポリシー</a> と <a href="/terms.html" target="_blank">利用規約</a> に同意したものとみなされます。`,
    send:"送信", sending:"送信しています…", done:"送信できました。ありがとうございます。", captcha:"サイト所有者のエラー：サイ トキーが無効です",
  },
  en:{
    page:"Inquiry", name:"Name", email:"Email", subject:"Subject", category:"Category", message:"Message",
    agree:`By sending, you agree to our <a href="/privacy.html" target="_blank">Privacy Policy</a> and <a href="/terms.html" target="_blank">Terms of Service</a>.`,
    send:"Send", sending:"Sending…", done:"Your message has been sent. Thank you!", captcha:"reCAPTCHA verification is required.",
  }
};

let currentLang = (new URLSearchParams(location.search).get("lang")||"ja").toLowerCase();
let widgetId = null;

/* === 言語切替 === */
function applyLang(){
  const dict = T[currentLang] || T.ja;
  document.documentElement.lang = currentLang;
  document.getElementById("titleTxt").textContent = dict.page;
  document.getElementById("lblName").textContent = dict.name;
  document.getElementById("lblEmail").textContent = dict.email;
  document.getElementById("lblSubject").textContent = dict.subject;
  document.getElementById("lblCategory").textContent = dict.category;
  document.getElementById("lblMessage").textContent = dict.message;
  document.getElementById("agreeNote").innerHTML = dict.agree;
  document.getElementById("btnSubmit").textContent = dict.send;

  document.getElementById("btnJA").classList.toggle("active", currentLang==="ja");
  document.getElementById("btnEN").classList.toggle("active", currentLang==="en");

  // reCAPTCHA を選択言語で再ロード
  loadRecaptcha(currentLang);
}

document.getElementById("btnJA").addEventListener("click", ()=>{ currentLang="ja"; applyLang(); history.replaceState(null,"","?lang=ja"); });
document.getElementById("btnEN").addEventListener("click", ()=>{ currentLang="en"; applyLang(); history.replaceState(null,"","?lang=en"); });

/* === reCAPTCHA ローダ（言語毎に script を差し替え・明示レンダリング） === */
function loadRecaptcha(lang){
  // 既存スクリプト除去
  const old = document.getElementById("recaptcha-api");
  if (old) old.remove();
  // コンテナ初期化
  const wrap = document.getElementById("recaptcha");
  wrap.innerHTML = "";
  widgetId = null;

  // onload コールバック名を固有化
  const cbName = "onRecaptchaLoad_" + Date.now();
  window[cbName] = function(){
    if (window.grecaptcha) {
      widgetId = grecaptcha.render("recaptcha", { sitekey: RECAPTCHA_SITE_KEY });
    }
  };

  // 言語指定付きで api.js を読み込み
  const s = document.createElement("script");
  s.id = "recaptcha-api";
  s.src = "https://www.google.com/recaptcha/api.js?onload="+cbName+"&render=explicit&hl="+(lang==="en"?"en":"ja");
  s.defer = true; s.async = true;
  document.body.appendChild(s);
}

/* === JSONP 送信 === */
function sendJSONP(url, cb){
  const cbName = "jsonp_cb_" + Date.now();
  window[cbName] = function(res){ try{ cb(null,res);}finally{ cleanup(); } };
  function cleanup(){
    delete window[cbName];
    scr.remove();
    clearTimeout(timer);
  }
  const scr = document.createElement("script");
  scr.src = url + (url.includes("?")?"&":"?") + "callback=" + cbName;
  scr.onerror = ()=>{ cb(new Error("network")); cleanup(); };
  document.body.appendChild(scr);
  const timer = setTimeout(()=>{ cb(new Error("timeout")); cleanup(); }, 20000);
}

/* === フォーム送信 === */
document.getElementById("inquiryForm").addEventListener("submit", function(e){
  e.preventDefault();
  const dict = T[currentLang] || T.ja;
  const status = document.getElementById("status");
  const errBox = document.getElementById("captchaErr");
  errBox.style.display = "none"; errBox.textContent = "";

  const token = (window.grecaptcha && widgetId!=null) ? grecaptcha.getResponse(widgetId) : "";
  if (!token) {
    errBox.style.display = "block";
    errBox.textContent = dict.captcha;
    return;
  }

  const name = document.getElementById("name").value.trim();
  const email = document.getElementById("email").value.trim();
  const subject = document.getElementById("subject").value.trim();
  const category = document.getElementById("category").value;
  const message = document.getElementById("message").value.trim();

  // カテゴリは件名に付記
  const subjectWithCat = subject ? `[${category}] ${subject}` : `[${category}]`;

  status.textContent = dict.sending;
  document.getElementById("btnSubmit").disabled = true;

  // JSONP で送信（CORS不要・GAS側 doGet で受ける）
  const params = new URLSearchParams({
    mode:"contact_submit",
    name, email,
    subject: subjectWithCat,
    message, token
  });

  const url = GAS_JSONP + "?" + params.toString();

  sendJSONP(url, (err, res)=>{
    document.getElementById("btnSubmit").disabled = false;
    if (err){ status.textContent = (currentLang==="en"?"Failed to send. Please try again.":"送信に失敗しました。時間をおいて再度お試しください。"); return; }
    if (res && res.ok){
      status.textContent = dict.done;
      // 送信後は内容をクリア & reCAPTCHA をリセット
      document.getElementById("inquiryForm").reset();
      if (window.grecaptcha && widgetId!=null) grecaptcha.reset(widgetId);
    }else{
      const reason = (res && res.reason) || "unknown";
      status.textContent = (currentLang==="en" ? `Failed: ${reason}` : `失敗: ${reason}`);
    }
  });
});

/* 初期化 */
applyLang();
</script>
</body>
</html>
