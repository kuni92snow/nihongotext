<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Inquiry | nihongotext.com</title>
  <style>
    :root{--fg:#111;--muted:#6b7280;--accent:#10b981;--danger:#ef4444;--bg:#fff;--border:#e5e7eb}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,ui-sans-serif;color:var(--fg);background:var(--bg)}
    .wrap{max-width:980px;margin:24px auto;padding:0 16px}
    h1{font-size:28px;margin:0 0 16px}
    .lang{display:flex;gap:8px;margin-bottom:16px}
    .pill{padding:6px 10px;border:1px solid var(--border);border-radius:999px;background:#f8fafc;cursor:pointer}
    .pill.active{background:#111;color:#fff;border-color:#111}
    .card{border:1px solid var(--border);border-radius:12px;padding:16px;background:#fff}
    .grid{display:grid;grid-template-columns:1fr;gap:16px}
    @media (min-width:900px){.grid{grid-template-columns:1.1fr}}
    label{display:block;font-size:12px;color:var(--muted);margin:10px 0 6px}
    input,textarea{width:100%;box-sizing:border-box;font:inherit;padding:10px;border:1px solid var(--border);border-radius:8px;background:#fff}
    textarea{min-height:160px;resize:vertical}
    .row{display:flex;gap:10px;align-items:center;margin-top:12px}
    .btn{padding:10px 16px;border:1px solid var(--border);border-radius:8px;background:#111;color:#fff;cursor:pointer}
    .btn.secondary{background:#fff;color:#111}
    .note{font-size:12px;color:var(--muted);margin-top:8px}
    .msg-ok{color:var(--accent);font-weight:600}
    .msg-ng{color:var(--danger);font-weight:600}
    .hidden{display:none}
  </style>
  <!-- reCAPTCHA v2 (checkbox) -->
  <script src="https://www.google.com/recaptcha/api.js" async defer></script>
</head>
<body>
  <div class="wrap">
    <h1>Inquiry (otoiawase) </h1>

    <!-- 言語切替 -->
    <div class="lang">
      <button id="btnJa" class="pill">日本語</button>
      <button id="btnEn" class="pill">English</button>
    </div>

    <div class="grid">
      <!-- Contact -->
      <section class="card">
        <h2 id="hContact">お問い合わせ</h2>

        <!-- 非表示iframe（クロスオリジンPOSTでもページ遷移しない） -->
        <iframe name="submit_iframe" id="submit_iframe" class="hidden"></iframe>

        <!-- 送信フォーム：直接 Apps Script へ POST（x-www-form-urlencoded） -->
        <form
          id="contactForm"
          target="submit_iframe"
          method="POST"
          action="https://script.google.com/macros/s/AKfycbzHvm3JmrYzJChzIPJJIR7PsAMmMOaPBKXVEyBXLeLQ_7mMrhCOJ_DdWxE75TVxWwWZvQ/exec"
        >
          <label for="name" id="lbName">お名前 / Name</label>
          <input id="name" name="name" autocomplete="name" />

          <label for="email" id="lbEmail">メール / Email</label>
          <input id="email" name="email" type="email" autocomplete="email" />

          <label for="subject" id="lbSubject">件名 / Subject</label>
          <input id="subject" name="subject" />

          <label for="message" id="lbMessage">メッセージ / Message</label>
          <textarea id="message" name="message"></textarea>

          <!-- reCAPTCHA トークンは hidden に入れて送信 -->
          <input type="hidden" id="token" name="token" />

          <div class="row">
            <div class="g-recaptcha" data-sitekey="6LcRKvArAAAAAFVmY21y9o_hwTszHwzp3bgRXtBV"></div>
            <button type="button" id="btnCancel" class="btn secondary">キャンセル</button>
            <button type="submit" id="btnSend" class="btn">送信</button>
          </div>

          <div class="note" id="rcNote">
            reCAPTCHA と Google の <a href="https://policies.google.com/privacy?hl=ja" target="_blank" rel="noopener">プライバシー ポリシー</a> と
            <a href="https://policies.google.com/terms?hl=ja" target="_blank" rel="noopener">利用規約</a> が適用されます。
          </div>

          <div class="note" id="msg" aria-live="polite"></div>
        </form>
      </section>
    </div>
  </div>

  <script>
    // ===== 言語判定 =====
    const params = new URL(location.href).searchParams;
    let LANG = params.get('lang') === 'en' ? 'en' : 'ja';
    const T = {
      ja: {
        contact: 'お問い合わせ',
        name: 'お名前 / Name',
        email: 'メール / Email',
        subject: '件名 / Subject',
        message: 'メッセージ / Message',
        cancel: 'キャンセル',
        send: '送信',
        sentok: '送信しました。ありがとうございます。',
        sentng: '送信に失敗しました。時間をおいて再度お試しください。',
        recaptcha_need: 'reCAPTCHA をチェックしてください。'
      },
      en: {
        contact: 'Contact',
        name: 'Name',
        email: 'Email',
        subject: 'Subject',
        message: 'Message',
        cancel: 'Cancel',
        send: 'Send',
        sentok: 'Your message has been sent. Thank you!',
        sentng: 'Failed to send. Please try again later.',
        recaptcha_need: 'Please check the reCAPTCHA box.'
      }
    };
    function applyLang() {
      const t = T[LANG];
      document.getElementById('hContact').textContent = t.contact;
      document.getElementById('lbName').textContent = t.name;
      document.getElementById('lbEmail').textContent = t.email;
      document.getElementById('lbSubject').textContent = t.subject;
      document.getElementById('lbMessage').textContent = t.message;
      document.getElementById('btnCancel').textContent = t.cancel;
      document.getElementById('btnSend').textContent = t.send;
      // pill UI
      document.getElementById('btnJa').classList.toggle('active', LANG==='ja');
      document.getElementById('btnEn').classList.toggle('active', LANG==='en');
      const url = new URL(location.href);
      url.searchParams.set('lang', LANG);
      history.replaceState(null, '', url.toString());
    }
    document.getElementById('btnJa').onclick = () => { LANG='ja'; applyLang(); };
    document.getElementById('btnEn').onclick = () => { LANG='en'; applyLang(); };
    applyLang();

    // ===== 送信制御（iframe方式） =====
    const form = document.getElementById('contactForm');
    const msg = document.getElementById('msg');
    const btnSend = document.getElementById('btnSend');
    const btnCancel = document.getElementById('btnCancel');
    const iframe = document.getElementById('submit_iframe');

    // iframe のロード完了＝GAS が応答した → 成功メッセージを表示（内容は読めないが完了は分かる）
    iframe.addEventListener('load', () => {
      btnSend.disabled = false;
      const t = T[LANG];
      msg.textContent = t.sentok;
      msg.className = 'note msg-ok';
      // フォーム初期化
      form.reset();
      if (window.grecaptcha) grecaptcha.reset();
    });

    form.addEventListener('submit', (ev) => {
      // 事前に reCAPTCHA トークンを hidden に入れる
      const t = T[LANG];
      const token = window.grecaptcha ? grecaptcha.getResponse() : '';
      if (!token) {
        ev.preventDefault();
        msg.textContent = t.recaptcha_need;
        msg.className = 'note msg-ng';
        return;
      }
      document.getElementById('token').value = token;
      // 送信中ロック
      btnSend.disabled = true;
      msg.textContent = '';
      msg.className = 'note';
      // 以降はブラウザがそのままクロスオリジンPOST（CORS不要）
      // 応答は iframe の load イベントで受ける
    });

    btnCancel.addEventListener('click', () => {
      form.reset();
      msg.textContent = '';
      msg.className = 'note';
      if (window.grecaptcha) grecaptcha.reset();
    });
  </script>
</body>
</html>
