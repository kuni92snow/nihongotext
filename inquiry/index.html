<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Inquiry | nihongotext.com</title>

<!-- åŸºæœ¬ã‚¹ã‚¿ã‚¤ãƒ«ï¼ˆãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ã¨åŒç³»è‰²ï¼‰ -->
<style>
  :root{
    --brand:#e74c3c;        /* æœ±è‰²ï¼ˆãƒ˜ãƒƒãƒ€ãƒ¼ãƒ©ã‚¤ãƒ³ãƒ»ãƒœã‚¿ãƒ³ï¼‰ */
    --brand-weak:#fbe8e6;   /* æœ±è‰²ã®æ·¡è‰²ï¼ˆã‚«ãƒ¼ãƒ‰èƒŒæ™¯ï¼‰ */
    --text:#333;
    --border:#e6e6e6;
  }
  *{box-sizing:border-box}
  body{margin:0;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Hiragino Kaku Gothic ProN","Noto Sans JP","Yu Gothic UI",Meiryo,sans-serif;color:var(--text);background:#fff}
  a{color:var(--brand);text-decoration:none}
  a:hover{text-decoration:underline}

  /* ãƒ˜ãƒƒãƒ€ãƒ¼ */
  .site-header{
    position:sticky;top:0;z-index:50;background:#fff;border-bottom:3px solid var(--brand);
  }
  .header-inner{
    max-width:1080px;margin:0 auto;display:flex;align-items:center;gap:12px;padding:16px 12px;
  }
  .brand{font-weight:800;font-size:28px;color:var(--brand)}
  .beta{font-size:12px;opacity:.65}
  .spacer{flex:1}

  /* è¨€èªãƒœã‚¿ãƒ³ï¼ˆå³ç«¯å›ºå®šï¼‰ */
  .lang-switch{display:flex;gap:8px;align-items:center}
  .lang-btn{
    border:1px solid var(--border);background:#fff;border-radius:999px;padding:6px 12px;font-size:13px;cursor:pointer;
  }
  .lang-btn.active{border-color:var(--brand);color:#fff;background:var(--brand)}
  .iconbar{display:flex;gap:10px;margin-left:16px}
  .iconbtn{width:28px;height:28px;border-radius:50%;border:1px solid var(--border);display:flex;align-items:center;justify-content:center;cursor:pointer}

  /* ã‚³ãƒ³ãƒ†ãƒŠ */
  .container{max-width:900px;margin:24px auto;padding:0 12px}
  .card{
    background:var(--brand-weak);border:1px solid var(--border);border-radius:12px;padding:18px 16px;
  }
  .card h2{margin:0 0 14px;font-size:18px}

  /* ãƒ•ã‚©ãƒ¼ãƒ  */
  .row{display:flex;gap:12px;margin-bottom:10px}
  .col{flex:1}
  .input, .select, .textarea{
    width:100%;border:1px solid var(--border);border-radius:8px;padding:10px 12px;font-size:14px;background:#fff;
  }
  .textarea{min-height:160px;resize:vertical}
  .note{font-size:12px;opacity:.75;margin-top:8px}
  .actions{margin-top:16px;display:flex;gap:10px;align-items:center}
  .btn{
    background:var(--brand);color:#fff;border:none;border-radius:10px;padding:10px 16px;font-weight:700;cursor:pointer;
  }
  .btn:disabled{opacity:.55;cursor:not-allowed}
  .status{font-size:13px}

  /* ãƒ•ãƒƒã‚¿ãƒ¼ */
  .site-footer{border-top:2px solid var(--brand);padding:18px 0;margin-top:40px}
  .footer-inner{max-width:1080px;margin:0 auto;padding:0 12px;text-align:center;font-size:12px;opacity:.8}
  .foot-icons{display:flex;gap:10px;justify-content:center;margin-top:10px}

  /* å°ã•ã‚ç”»é¢ */
  @media (max-width:640px){ .row{flex-direction:column} }
</style>
</head>
<body>

<!-- ãƒ˜ãƒƒãƒ€ãƒ¼ï¼šãƒ­ã‚´ + å³ç«¯ã«è¨€èªãƒœã‚¿ãƒ³ -->
<header class="site-header">
  <div class="header-inner">
    <div class="brand">nihongotext<span class="beta">.com  == beta version ==</span></div>
    <div class="spacer"></div>

    <div class="lang-switch" id="langSwitch">
      <button class="lang-btn" data-lang="ja" id="btnJA">æ—¥æœ¬èª</button>
      <button class="lang-btn" data-lang="en" id="btnEN">English</button>
    </div>

    <div class="iconbar" aria-hidden="true">
      <div class="iconbtn">ğŸ </div>
      <div class="iconbtn">ğŸ”</div>
      <div class="iconbtn">ğŸ“</div>
      <div class="iconbtn">ğŸ“§</div>
    </div>
  </div>
</header>

<main class="container">
  <section class="card">
    <h2 id="titleTxt">ãŠå•ã„åˆã‚ã›</h2>

    <form id="inquiryForm">
      <div class="row">
        <div class="col">
          <label id="lblName" for="name">ãŠåå‰</label>
          <input class="input" id="name" name="name" autocomplete="name" />
        </div>
        <div class="col">
          <label id="lblEmail" for="email">ãƒ¡ãƒ¼ãƒ«</label>
          <input class="input" id="email" name="email" type="email" autocomplete="email" />
        </div>
      </div>

      <div class="row">
        <div class="col">
          <label id="lblSubject" for="subject">ä»¶å</label>
          <input class="input" id="subject" name="subject" />
        </div>
        <div class="col">
          <label id="lblCategory" for="category">ã‚«ãƒ†ã‚´ãƒª</label>
          <select class="select" id="category" name="category">
            <option value="general">ä¸€èˆ¬</option>
            <option value="bug">ä¸å…·åˆ</option>
            <option value="request">æ©Ÿèƒ½è¦æœ›</option>
            <option value="other">ãã®ä»–</option>
          </select>
        </div>
      </div>

      <div class="row">
        <div class="col">
          <label id="lblMessage" for="message">å†…å®¹</label>
          <textarea class="textarea" id="message" name="message"></textarea>
        </div>
      </div>

      <!-- reCAPTCHAï¼ˆå‹•çš„ã«è¨€èªã‚’åˆ‡æ›¿ï¼‰ -->
      <div id="captchaWrap" class="row" style="margin-top:6px">
        <div class="col">
          <div id="recaptcha"></div>
          <div id="captchaErr" class="note" style="color:#c00; display:none"></div>
        </div>
      </div>

      <div class="note" id="agreeNote">
        é€ä¿¡ã™ã‚‹ã¨ã€<a href="/privacy.html" target="_blank">ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼</a> ã¨
        <a href="/terms.html" target="_blank">åˆ©ç”¨è¦ç´„</a> ã«åŒæ„ã—ãŸã‚‚ã®ã¨ã¿ãªã•ã‚Œã¾ã™ã€‚
      </div>

      <div class="actions">
        <button type="submit" class="btn" id="btnSubmit">é€ä¿¡</button>
        <div id="status" class="status"></div>
      </div>
    </form>
  </section>
</main>

<footer class="site-footer">
  <div class="footer-inner">
    <div class="foot-icons" aria-hidden="true">
      <div class="iconbtn">ğŸ </div>
      <div class="iconbtn">ğŸ”</div>
      <div class="iconbtn">ğŸ“</div>
      <div class="iconbtn">ğŸ“§</div>
    </div>
    <div style="margin-top:6px">Â© 2025 nihongotext.com</div>
  </div>
</footer>

<!-- ===== ãƒ•ãƒ­ãƒ³ãƒˆãƒ­ã‚¸ãƒƒã‚¯ ===== -->
<script>
/* === è¨­å®š === */
const GAS_JSONP = "https://script.google.com/macros/s/AKfycbwOZYS2HD-rvYVGFMkKsgm0feGWxgFypjpPbhVE8LYgKJe1T3lXfkgDNAiKIjJZcZNdNA/exec";
const RECAPTCHA_SITE_KEY = "6LcRKvArAAAAAFVmY21y9o_hwTszHwzp3bgRXtBV"; // ã”æŒ‡å®š Site key

/* === i18n ãƒ†ã‚­ã‚¹ãƒˆ === */
const T = {
  ja:{
    page:"ãŠå•ã„åˆã‚ã›", name:"ãŠåå‰", email:"ãƒ¡ãƒ¼ãƒ«", subject:"ä»¶å", category:"ã‚«ãƒ†ã‚´ãƒª", message:"å†…å®¹",
    agree:`é€ä¿¡ã™ã‚‹ã¨ã€<a href="/privacy.html" target="_blank">ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼</a> ã¨ <a href="/terms.html" target="_blank">åˆ©ç”¨è¦ç´„</a> ã«åŒæ„ã—ãŸã‚‚ã®ã¨ã¿ãªã•ã‚Œã¾ã™ã€‚`,
    send:"é€ä¿¡", sending:"é€ä¿¡ã—ã¦ã„ã¾ã™â€¦", done:"é€ä¿¡ã§ãã¾ã—ãŸã€‚ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚", captcha:"ã‚µã‚¤ãƒˆæ‰€æœ‰è€…ã®ã‚¨ãƒ©ãƒ¼ï¼šã‚µã‚¤ ãƒˆã‚­ãƒ¼ãŒç„¡åŠ¹ã§ã™",
  },
  en:{
    page:"Inquiry", name:"Name", email:"Email", subject:"Subject", category:"Category", message:"Message",
    agree:`By sending, you agree to our <a href="/privacy.html" target="_blank">Privacy Policy</a> and <a href="/terms.html" target="_blank">Terms of Service</a>.`,
    send:"Send", sending:"Sendingâ€¦", done:"Your message has been sent. Thank you!", captcha:"reCAPTCHA verification is required.",
  }
};

let currentLang = (new URLSearchParams(location.search).get("lang")||"ja").toLowerCase();
let widgetId = null;

/* === è¨€èªåˆ‡æ›¿ === */
function applyLang(){
  const dict = T[currentLang] || T.ja;
  document.documentElement.lang = currentLang;
  document.getElementById("titleTxt").textContent = dict.page;
  document.getElementById("lblName").textContent = dict.name;
  document.getElementById("lblEmail").textContent = dict.email;
  document.getElementById("lblSubject").textContent = dict.subject;
  document.getElementById("lblCategory").textContent = dict.category;
  document.getElementById("lblMessage").textContent = dict.message;
  document.getElementById("agreeNote").innerHTML = dict.agree;
  document.getElementById("btnSubmit").textContent = dict.send;

  document.getElementById("btnJA").classList.toggle("active", currentLang==="ja");
  document.getElementById("btnEN").classList.toggle("active", currentLang==="en");

  // reCAPTCHA ã‚’é¸æŠè¨€èªã§å†ãƒ­ãƒ¼ãƒ‰
  loadRecaptcha(currentLang);
}

document.getElementById("btnJA").addEventListener("click", ()=>{ currentLang="ja"; applyLang(); history.replaceState(null,"","?lang=ja"); });
document.getElementById("btnEN").addEventListener("click", ()=>{ currentLang="en"; applyLang(); history.replaceState(null,"","?lang=en"); });

/* === reCAPTCHA ãƒ­ãƒ¼ãƒ€ï¼ˆè¨€èªæ¯ã« script ã‚’å·®ã—æ›¿ãˆãƒ»æ˜ç¤ºãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ï¼‰ === */
function loadRecaptcha(lang){
  // æ—¢å­˜ã‚¹ã‚¯ãƒªãƒ—ãƒˆé™¤å»
  const old = document.getElementById("recaptcha-api");
  if (old) old.remove();
  // ã‚³ãƒ³ãƒ†ãƒŠåˆæœŸåŒ–
  const wrap = document.getElementById("recaptcha");
  wrap.innerHTML = "";
  widgetId = null;

  // onload ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯åã‚’å›ºæœ‰åŒ–
  const cbName = "onRecaptchaLoad_" + Date.now();
  window[cbName] = function(){
    if (window.grecaptcha) {
      widgetId = grecaptcha.render("recaptcha", { sitekey: RECAPTCHA_SITE_KEY });
    }
  };

  // è¨€èªæŒ‡å®šä»˜ãã§ api.js ã‚’èª­ã¿è¾¼ã¿
  const s = document.createElement("script");
  s.id = "recaptcha-api";
  s.src = "https://www.google.com/recaptcha/api.js?onload="+cbName+"&render=explicit&hl="+(lang==="en"?"en":"ja");
  s.defer = true; s.async = true;
  document.body.appendChild(s);
}

/* === JSONP é€ä¿¡ === */
function sendJSONP(url, cb){
  const cbName = "jsonp_cb_" + Date.now();
  window[cbName] = function(res){ try{ cb(null,res);}finally{ cleanup(); } };
  function cleanup(){
    delete window[cbName];
    scr.remove();
    clearTimeout(timer);
  }
  const scr = document.createElement("script");
  scr.src = url + (url.includes("?")?"&":"?") + "callback=" + cbName;
  scr.onerror = ()=>{ cb(new Error("network")); cleanup(); };
  document.body.appendChild(scr);
  const timer = setTimeout(()=>{ cb(new Error("timeout")); cleanup(); }, 20000);
}

/* === ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡ === */
document.getElementById("inquiryForm").addEventListener("submit", function(e){
  e.preventDefault();
  const dict = T[currentLang] || T.ja;
  const status = document.getElementById("status");
  const errBox = document.getElementById("captchaErr");
  errBox.style.display = "none"; errBox.textContent = "";

  const token = (window.grecaptcha && widgetId!=null) ? grecaptcha.getResponse(widgetId) : "";
  if (!token) {
    errBox.style.display = "block";
    errBox.textContent = dict.captcha;
    return;
  }

  const name = document.getElementById("name").value.trim();
  const email = document.getElementById("email").value.trim();
  const subject = document.getElementById("subject").value.trim();
  const category = document.getElementById("category").value;
  const message = document.getElementById("message").value.trim();

  // ã‚«ãƒ†ã‚´ãƒªã¯ä»¶åã«ä»˜è¨˜
  const subjectWithCat = subject ? `[${category}] ${subject}` : `[${category}]`;

  status.textContent = dict.sending;
  document.getElementById("btnSubmit").disabled = true;

  // JSONP ã§é€ä¿¡ï¼ˆCORSä¸è¦ãƒ»GASå´ doGet ã§å—ã‘ã‚‹ï¼‰
  const params = new URLSearchParams({
    mode:"contact_submit",
    name, email,
    subject: subjectWithCat,
    message, token
  });

  const url = GAS_JSONP + "?" + params.toString();

  sendJSONP(url, (err, res)=>{
    document.getElementById("btnSubmit").disabled = false;
    if (err){ status.textContent = (currentLang==="en"?"Failed to send. Please try again.":"é€ä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸã€‚æ™‚é–“ã‚’ãŠã„ã¦å†åº¦ãŠè©¦ã—ãã ã•ã„ã€‚"); return; }
    if (res && res.ok){
      status.textContent = dict.done;
      // é€ä¿¡å¾Œã¯å†…å®¹ã‚’ã‚¯ãƒªã‚¢ & reCAPTCHA ã‚’ãƒªã‚»ãƒƒãƒˆ
      document.getElementById("inquiryForm").reset();
      if (window.grecaptcha && widgetId!=null) grecaptcha.reset(widgetId);
    }else{
      const reason = (res && res.reason) || "unknown";
      status.textContent = (currentLang==="en" ? `Failed: ${reason}` : `å¤±æ•—: ${reason}`);
    }
  });
});

/* åˆæœŸåŒ– */
applyLang();
</script>
</body>
</html>
