<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Inquiry | nihongotext.com</title>
<link rel="icon" href="/favicon.ico" />
<link rel="icon" type="image/png" href="/icon-512.png" sizes="512x512">
<link rel="apple-touch-icon" href="/icon-512.png" sizes="512x512">
<link rel="manifest" href="/manifest.webmanifest">
<meta name="theme-color" content="#b22222" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">

<!-- GA4 -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-9QSHWJE0HZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-9QSHWJE0HZ', { send_page_view:false });
</script>

<style>
:root{ --shu:#e6462d; --line:#e5e7eb; --muted:#6b7280; }
*{box-sizing:border-box}
html,body{margin:0;background:#fff;color:#1f2937;font:16px/1.65 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Noto Sans JP","Hiragino Kaku Gothic ProN","Yu Gothic UI","Meiryo",sans-serif}
a{color:inherit;text-decoration:none}
.wrap{max-width:1100px;margin:0 auto;padding:0 16px}
.btn{border:1px solid var(--shu);color:var(--shu);background:#fff;border-radius:10px;padding:8px 12px;font-weight:700;cursor:pointer}
h1{font-size:22px;margin:14px 0}
form .row{display:flex;gap:12px;flex-wrap:wrap;margin:10px 0}
label{display:block;font-weight:700;font-size:14px}
input,textarea{width:100%;border:1px solid var(--line);border-radius:10px;padding:10px 12px;font:inherit}
textarea{min-height:140px}
.note{color:var(--muted);font-size:13px}
hr.sep{border:0;border-top:1px dashed var(--line);margin:14px 0}

/* modal base (Learning/Learned) */
.mask{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.45);z-index:90}
.mask.show{display:flex}
.win{background:#fff;border-radius:12px;max-width:820px;width:min(96vw,820px);padding:12px;border:2px solid var(--shu)}
.win .x{float:right;border:1px solid var(--shu);color:var(--shu);background:#fff;border-radius:8px;padding:4px 9px;cursor:pointer}
.pager{display:flex;gap:8px;align-items:center;justify-content:center;margin:12px 0 6px}
.pagebtn{border:1px solid var(--line);background:#fff;border-radius:8px;padding:6px 10px;cursor:pointer}
.pagebtn.active{border-color:var(--shu);color:var(--shu);font-weight:800}
.item-row{padding:8px 0;border-bottom:1px dashed var(--line);display:flex;gap:10px;align-items:center;flex-wrap:wrap;justify-content:space-between}
.item-left{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
.item-actions{margin-left:auto}
.toggle-row{display:flex;gap:10px;align-items:center;flex-wrap:wrap;margin:8px 0}
.toggle-row label{display:inline-flex;gap:6px;align-items:center;border:1px solid var(--line);padding:6px 10px;border-radius:10px;background:#fff}
.tools{display:flex;gap:8px;justify-content:flex-end;margin:10px 0}
.smallbar{display:flex;justify-content:flex-end;align-items:center;gap:10px;padding:8px 0;border-bottom:1px solid #f3f4f6}
</style>
</head>
<body>

<!-- ヘッダーは部分テンプレート読込 -->
<header class="top" style="background:#fff;border-bottom:1px solid #eee;">
  <div id="site-header" class="wrap" style="padding:8px 0;"></div>
  <!-- ページ固有の日本語トグル（残す） -->
  <div class="wrap smallbar">
    <button id="langBtn" class="btn" type="button">日本語</button>
  </div>
</header>

<main class="wrap" style="padding:16px 0 24px">
  <h1 id="title">Inquiry</h1>
  <p id="lead" class="note">Feel free to send us your questions or feedback.</p>

  <form id="inqForm" action="https://script.google.com/macros/s/AKfycbwOZYS2HD-rvYVGFMkKsgm0feGWxgFypjpPbhVE8LYgKJe1T3lXfkgDNAiKIjJZcZNdNA/exec" method="POST">
    <div class="row">
      <div style="flex:1 1 260px">
        <label id="lbName">Your name</label>
        <input name="name" required />
      </div>
      <div style="flex:1 1 260px">
        <label id="lbMail">Email</label>
        <input name="email" type="email" required />
      </div>
    </div>
    <div class="row">
      <div style="flex:1 1 100%">
        <label id="lbMsg">Message</label>
        <textarea name="message" required></textarea>
      </div>
    </div>
    <div class="row" style="justify-content:flex-end">
      <button class="btn" type="submit" id="btnSend">Send</button>
    </div>
  </form>

  <hr class="sep">
  <p class="note" id="privacyNote">We won’t share your email with third parties.</p>
</main>

<!-- フッターは部分テンプレート読込 -->
<footer>
  <div id="site-footer" class="wrap" style="padding:16px 0"></div>
</footer>

<!-- ==== Learning / Learned モーダル（簡易版：閲覧・印刷・移動） ==== -->
<div id="learningModal" class="mask" aria-hidden="true">
  <div class="win">
    <button class="x" id="closeLearning" aria-label="Close">×</button>
    <h3 style="margin:0 0 10px">Learning</h3>

    <div class="toggle-row">
      <label><input type="checkbox" id="LG_JA" checked> Nihongo</label>
      <label><input type="checkbox" id="LG_KANA" checked> Hiragana</label>
      <label><input type="checkbox" id="LG_RO" checked> Alphabet</label>
      <label><input type="checkbox" id="LG_EN" checked> English</label>
    </div>

    <div class="tools">
      <button id="toLearnedViewTop" class="btn">Open Learned</button>
      <button id="printLearningTop" class="btn" style="background:var(--shu);color:#fff;border-color:var(--shu)">Print</button>
    </div>

    <div id="learningBody" style="border-top:1px dashed #ddd;margin-top:6px"></div>
    <div id="learningPager" class="pager"></div>

    <div class="tools">
      <button id="toLearnedView" class="btn">Open Learned</button>
      <button id="printLearning" class="btn" style="background:var(--shu);color:#fff;border-color:var(--shu)">Print</button>
    </div>
  </div>
</div>

<div id="learnedModal" class="mask" aria-hidden="true">
  <div class="win">
    <button class="x" id="closeLearned" aria-label="Close">×</button>
    <h3 style="margin:0 0 10px">Learned</h3>

    <div class="toggle-row">
      <label><input type="checkbox" id="L_JA" checked> Nihongo</label>
      <label><input type="checkbox" id="L_KANA" checked> Hiragana</label>
      <label><input type="checkbox" id="L_RO" checked> Alphabet</label>
      <label><input type="checkbox" id="L_EN" checked> English</label>
    </div>

    <div id="learnedBody" style="border-top:1px dashed #ddd;margin-top:6px"></div>
    <div id="learnedPager" class="pager"></div>

    <div class="tools">
      <button id="printLearned" class="btn" style="background:var(--shu);color:#fff;border-color:var(--shu)">Print</button>
    </div>
  </div>
</div>

<script>
/* ========= 共通：部分テンプレート読込 ========= */
async function injectPartials(){
  const hdr=document.getElementById('site-header');
  const ftr=document.getElementById('site-footer');
  try{
    const h=await fetch('/partials/header.html',{cache:'no-store'}).then(r=>r.ok?r.text():Promise.reject());
    hdr.innerHTML=h;
  }catch(_){
    // 最小フォールバック（余白無しロゴ）
    hdr.innerHTML =
      `<div style="padding:8px 0;display:flex;gap:12px;align-items:center;justify-content:center;flex-direction:column">
         <a href="/" style="display:flex;align-items:center;gap:8px;text-decoration:none;">
           <img src="/icon-512.png" alt="nihongotext logo" style="width:32px;height:32px;border-radius:6px;display:block;margin:0;padding:0;">
           <span style="font-weight:800;font-size:32px;color:#e6462d;">nihongotext<span style="color:#333">.com</span></span>
         </a>
         <div style="font-size:20px;color:#98a1a8">== beta version ==</div>
       </div>`;
  }
  try{
    const f=await fetch('/partials/footer.html',{cache:'no-store'}).then(r=>r.ok?r.text():Promise.reject());
    ftr.innerHTML=f;
  }catch(_){
    ftr.innerHTML = `<div style="text-align:center;color:#98a1a8">© 2025 nihongotext.com</div>`;
  }

  // ヘッダーの Learning / Learned をこのページのモーダルに接続
  const openLearningBtn = hdr.querySelector('#learnBtn')   || hdr.querySelector('[data-open="learning"]');
  const openLearnedBtn  = hdr.querySelector('#learnedBtn') || hdr.querySelector('[data-open="learned"]');
  if (openLearningBtn) openLearningBtn.addEventListener('click', ()=> openLearning());
  if (openLearnedBtn)  openLearnedBtn .addEventListener('click', ()=> openLearned());
  updateBadges(); // バッジ数更新（ヘッダーにあれば反映）
}

/* ========= 言語トグル（ページ固有。日本語表記を残す） ========= */
const getLang = () => localStorage.getItem('lang') || 'en';
const setLang = (v) => localStorage.setItem('lang', v);
let uiLang = getLang();

function applyLang(){
  const ja = (uiLang!=='en');
  document.getElementById('title').textContent = ja ? 'お問い合わせ' : 'Inquiry';
  document.getElementById('lead').textContent  = ja ? 'ご質問・ご要望などがあれば、こちらのフォームからお送りください。' : 'Feel free to send us your questions or feedback.';
  document.getElementById('lbName').textContent= ja ? 'お名前' : 'Your name';
  document.getElementById('lbMail').textContent= ja ? 'メールアドレス' : 'Email';
  document.getElementById('lbMsg').textContent = ja ? 'メッセージ' : 'Message';
  document.getElementById('btnSend').textContent = ja ? '送信' : 'Send';
  document.getElementById('privacyNote').textContent = ja ? 'ご記入いただいたメールアドレスは第三者に提供しません。' : 'We won’t share your email with third parties.';
  const btn = document.getElementById('langBtn');
  if(btn) btn.textContent = ja ? 'English' : '日本語';
}

document.getElementById('langBtn').addEventListener('click', ()=>{
  uiLang = (uiLang==='en') ? 'ja' : 'en';
  setLang(uiLang);
  applyLang();
});

/* ========= Learning / Learned（ローカルストレージ連携｜簡易ビュー） ========= */
const PAGE = 5;
const LEARN_KEY = 'ntx_learning_v3';
const LEARNED_STORE = 'ntx_learned_items_v1';
const LEARNED_DATE_KEY = 'ntx_learned_dates_v1';
const getLearning = ()=>{ try{return JSON.parse(localStorage.getItem(LEARN_KEY)||'[]')}catch(_){return[]} };
const setLearning = (arr)=>{ try{localStorage.setItem(LEARN_KEY,JSON.stringify(arr));}catch(_){ } };
const getLearnedMap= ()=>{ try{return JSON.parse(localStorage.getItem(LEARNED_STORE)||'{}')}catch(_){return{}} };
const setLearnedMap= (m)=> localStorage.setItem(LEARNED_STORE, JSON.stringify(m));
const getLearnedDates = ()=>{ try{return JSON.parse(localStorage.getItem(LEARNED_DATE_KEY)||'{}')}catch(_){return {}} };
const setLearnedDate  = (id,d)=>{ const m=getLearnedDates(); m[id]=d; localStorage.setItem(LEARNED_DATE_KEY,JSON.stringify(m)); };

function updateBadges(){
  const hdr=document.getElementById('site-header');
  const bLrn  = hdr?.querySelector('#badge-learning');
  const bLrnd = hdr?.querySelector('#badge-learned');
  if (bLrn)  bLrn.textContent  = String(getLearning().length);
  if (bLrnd) bLrnd.textContent = String(Object.keys(getLearnedMap()).length);
}

/* === Learning モーダル === */
let learningPage=1;
function openLearning(){ document.getElementById('learningModal').classList.add('show'); learningPage=1; renderLearning(); }
document.getElementById('closeLearning').onclick=()=>document.getElementById('learningModal').classList.remove('show');
document.getElementById('learningModal').addEventListener('click',e=>{ if(e.target.id==='learningModal') e.currentTarget.classList.remove('show'); });
['LG_JA','LG_KANA','LG_RO','LG_EN'].forEach(id=>{ const el=document.getElementById(id); if(el) el.addEventListener('change',()=>renderLearning()); });
document.getElementById('toLearnedViewTop').addEventListener('click',()=>{ document.getElementById('learningModal').classList.remove('show'); openLearned();});
document.getElementById('toLearnedView').addEventListener('click',()=>{ document.getElementById('learningModal').classList.remove('show'); openLearned();});
document.getElementById('printLearningTop').addEventListener('click',printLearning);
document.getElementById('printLearning').addEventListener('click',printLearning);

function renderLearning(){
  const wrap=document.getElementById('learningBody');
  const pag =document.getElementById('learningPager');
  const showEN=document.getElementById('LG_EN')?.checked!==false;
  const showJA=document.getElementById('LG_JA')?.checked!==false;
  const showKA=document.getElementById('LG_KANA')?.checked!==false;
  const showRO=document.getElementById('LG_RO')?.checked!==false;

  const all = getLearning();
  wrap.innerHTML=''; pag.innerHTML='';
  if(!all.length){ wrap.innerHTML='<div style="color:#6b7280;padding-top:6px">No items yet.</div>'; return; }

  const total=Math.max(1,Math.ceil(all.length/PAGE));
  learningPage=Math.min(Math.max(1,learningPage),total);
  const start=(learningPage-1)*PAGE;
  const rows=all.slice(start,start+PAGE);

  rows.forEach((x,i)=>{
    const row=document.createElement('div'); row.className='item-row';
    const left=document.createElement('div'); left.className='item-left';
    const pieces=[];
    if(showJA&&x.ja)pieces.push(x.ja);
    if(showKA&&x.kana)pieces.push(x.kana);
    if(showRO&&x.ro)pieces.push(x.ro);
    if(showEN&&x.en)pieces.push(x.en);
    left.innerHTML = `${start+i+1}. <strong>${pieces.join(' / ')}</strong>${x.movedAt?` <span style="color:#888">(${x.movedAt})</span>`:''}`;

    const act=document.createElement('div'); act.className='item-actions';
    const mv=document.createElement('button'); mv.className='btn'; mv.textContent='Move to Learned';
    mv.addEventListener('click', ()=>{
      const m=getLearnedMap(); if(!m[x.id]) m[x.id]=x;
      setLearnedMap(m);
      const d=new Date(), z=n=>String(n).padStart(2,'0');
      setLearnedDate(x.id, `${d.getFullYear()}-${z(d.getMonth()+1)}-${z(d.getDate())}`);
      setLearning(getLearning().filter(y=>y.id!==x.id));
      renderLearning(); updateBadges();
    });
    act.appendChild(mv);

    row.append(left,act); wrap.appendChild(row);
  });

  const mk=(t,fn,active)=>{ const b=document.createElement('button'); b.className='pagebtn'; if(active) b.classList.add('active'); b.textContent=t; b.onclick=fn; return b; };
  const prev = mk('Prev', ()=>{learningPage=Math.max(1,learningPage-1); renderLearning();}, learningPage===1); prev.disabled=learningPage===1; pag.appendChild(prev);
  for(let i=1;i<=total;i++) pag.appendChild(mk(String(i), ()=>{learningPage=i; renderLearning();}, i===learningPage));
  const next = mk('Next', ()=>{learningPage=Math.min(total,learningPage+1); renderLearning();}, learningPage===total); next.disabled=learningPage===total; pag.appendChild(next);
}

function printLearning(){
  const arr=getLearning(); if(!arr.length){ alert('No learning items.'); return; }
  const w=open('','_blank');
  w.document.write('<!doctype html><meta charset="utf-8"><title>Learning</title><style>body{font:14px system-ui;padding:20px}.row{border-bottom:1px dashed #ccc;padding:6px 0}</style><h1>Learning</h1>');
  arr.forEach((x,i)=> w.document.write(`<div class="row">${i+1}. <strong>${x.ja||''}</strong> / ${x.kana||''} / ${x.ro||''} — ${x.en||''}${x.movedAt?` (${x.movedAt})`:''}</div>`));
  w.document.close(); w.print();
}

/* === Learned モーダル === */
let learnedPage=1;
function openLearned(){ document.getElementById('learnedModal').classList.add('show'); learnedPage=1; renderLearned(); }
document.getElementById('closeLearned').onclick=()=>document.getElementById('learnedModal').classList.remove('show');
document.getElementById('learnedModal').addEventListener('click',e=>{ if(e.target.id==='learnedModal') e.currentTarget.classList.remove('show'); });
['L_JA','L_KANA','L_RO','L_EN'].forEach(id=>{ const el=document.getElementById(id); if(el) el.addEventListener('change',()=>renderLearned()); });
document.getElementById('printLearned').addEventListener('click',()=>{
  const m=getLearnedMap(); const d=getLearnedDates(); const rows=Object.values(m);
  if(!rows.length){ alert('No learned items.'); return; }
  const w=open('','_blank');
  w.document.write('<!doctype html><meta charset="utf-8"><title>Learned</title><style>body{font:14px system-ui;padding:20px}.row{border-bottom:1px dashed #ccc;padding:6px 0}</style><h1>Learned</h1>');
  rows.forEach((x,i)=> w.document.write(`<div class="row">${i+1}. <strong>${x.ja||''}</strong> / ${x.kana||''} / ${x.ro||''} — ${x.en||''}${d[x.id]?` (${d[x.id]})`:''}</div>`));
  w.document.close(); w.print();
});

function renderLearned(){
  const wrap=document.getElementById('learnedBody');
  const pag =document.getElementById('learnedPager');
  const showEN=document.getElementById('L_EN')?.checked!==false;
  const showJA=document.getElementById('L_JA')?.checked!==false;
  const showKA=document.getElementById('L_KANA')?.checked!==false;
  const showRO=document.getElementById('L_RO')?.checked!==false;

  const map=getLearnedMap(); const dates=getLearnedDates();
  const all=Object.values(map);
  wrap.innerHTML=''; pag.innerHTML='';
  if(!all.length){ wrap.innerHTML='<div style="color:#6b7280;padding-top:6px">No items yet.</div>'; return; }

  const total=Math.max(1,Math.ceil(all.length/PAGE));
  learnedPage=Math.min(Math.max(1,learnedPage),total);
  const start=(learnedPage-1)*PAGE;
  const rows=all.slice(start,start+PAGE);

  rows.forEach((x,i)=>{
    const row=document.createElement('div'); row.className='item-row';
    const left=document.createElement('div'); left.className='item-left';
    const pieces=[];
    if(showJA&&x.ja)pieces.push(x.ja);
    if(showKA&&x.kana)pieces.push(x.kana);
    if(showRO&&x.ro)pieces.push(x.ro);
    if(showEN&&x.en)pieces.push(x.en);
    left.innerHTML = `${start+i+1}. <strong>${pieces.join(' / ')}</strong>${dates[x.id]?` <span style="color:#888">(${dates[x.id]})</span>`:''}`;

    const act=document.createElement('div'); act.className='item-actions';
    const back=document.createElement('button'); back.className='btn'; back.textContent='Back to Learning';
    back.addEventListener('click', ()=>{
      // learned から削除
      const m=getLearnedMap(); delete m[x.id]; setLearnedMap(m);
      const d=getLearnedDates(); delete d[x.id]; localStorage.setItem(LEARNED_DATE_KEY, JSON.stringify(d));
      // learning に戻す
      const arr=getLearning(); if(!arr.find(y=>y.id===x.id)) arr.push({...x, movedAt:d[x.id]||''}); setLearning(arr);
      renderLearned(); updateBadges();
    });
    act.appendChild(back);

    row.append(left,act); wrap.appendChild(row);
  });

  const mk=(t,fn,active)=>{ const b=document.createElement('button'); b.className='pagebtn'; if(active) b.classList.add('active'); b.textContent=t; b.onclick=fn; return b; };
  const prev = mk('Prev', ()=>{learnedPage=Math.max(1,learnedPage-1); renderLearned();}, learnedPage===1); prev.disabled=learnedPage===1; pag.appendChild(prev);
  for(let i=1;i<=total;i++) pag.appendChild(mk(String(i), ()=>{learnedPage=i; renderLearned();}, i===learnedPage));
  const next = mk('Next', ()=>{learnedPage=Math.min(total,learnedPage+1); renderLearned();}, learnedPage===total); next.disabled=learnedPage===total; pag.appendChild(next);
}

/* ========= init ========= */
(async function(){
  await injectPartials();
  applyLang();
  gtag('event','page_view',{page_title:'inquiry'});
})();
</script>
</body>
</html>
