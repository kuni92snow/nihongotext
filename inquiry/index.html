<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>お問い合わせ | nihongotext.com</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP&display=swap" />
  <style>
    body { font-family: 'Noto Sans JP', sans-serif; background-color: #fff; color: #333; text-align: center; }
    header, footer { color: #333; padding: 10px 0; }
    .container { max-width: 600px; margin: 40px auto; background: #fafafa; border-radius: 12px; padding: 20px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
    h2 { margin-bottom: 20px; }
    input, textarea { width: 100%; padding: 10px; margin-bottom: 10px; border: 1px solid #ccc; border-radius: 6px; font-size: 1em; }
    button { background-color: #ff6b6b; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; }
    button:hover { background-color: #e05555; }
    .error { color: red; margin-top: 10px; }
    .success { color: green; margin-top: 10px; }
  </style>
</head>
<body>
  <header>
    <div class="brand">nihongotext.com<br><span style="font-size: small;">== beta version ==</span></div>
  </header>

  <div class="container">
    <h2 id="form-title">お問い合わせ</h2>
    <form id="contact-form">
      <input type="text" id="name" name="name" placeholder="お名前" required />
      <input type="email" id="email" name="email" placeholder="メールアドレス" required />
      <input type="text" id="subject" name="subject" placeholder="件名" required />
      <textarea id="message" name="message" rows="5" placeholder="メッセージ" required></textarea>

      <!-- reCAPTCHA -->
      <div class="g-recaptcha" data-sitekey="6LcRkvArAAAAAFYmY2IyPo_hwTszHwzp3bgRXtBV"></div>

      <button type="submit" id="send-btn">送信</button>
      <div id="result"></div>
    </form>
  </div>

  <footer>
    © 2025 nihongotext.com
  </footer>

  <!-- reCAPTCHA -->
  <script src="https://www.google.com/recaptcha/api.js" async defer></script>

  <script>
    const GAS_URL = "https://script.google.com/macros/s/AKfycbzyHV_NSyJU-hPwvJU5JJMMuPAa7V3vhmRuq6Clq7WBIErCx6A2xHgG1SXtSlfmR42OHw/exec";

    document.getElementById("contact-form").addEventListener("submit", async (e) => {
      e.preventDefault();
      const result = document.getElementById("result");
      result.textContent = "";

      const token = grecaptcha.getResponse();
      if (!token) {
        result.textContent = "reCAPTCHAを確認してください。";
        result.className = "error";
        return;
      }

      const params = new URLSearchParams();
      params.append("name", document.getElementById("name").value);
      params.append("email", document.getElementById("email").value);
      params.append("subject", document.getElementById("subject").value);
      params.append("message", document.getElementById("message").value);
      params.append("g-recaptcha-response", token);

      try {
        const res = await fetch(GAS_URL + "?" + params.toString());
        const text = await res.text();

        if (text.includes('"ok":true')) {
          result.textContent = "送信しました。ありがとうございました。";
          result.className = "success";
          document.getElementById("contact-form").reset();
          grecaptcha.reset();
        } else {
          result.textContent = "送信に失敗しました。しばらくしてからもう一度お試しください。";
          result.className = "error";
          grecaptcha.reset();
        }
      } catch (err) {
        result.textContent = "エラーが発生しました。";
        result.className = "error";
        console.error(err);
      }
    });
  </script>
</body>
</html>
