<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Contact | nihongotext.com</title>

  <base href="/" />

  <link rel="icon" href="/favicon.ico" />
  <link rel="icon" type="image/png" href="/icon-512.png" sizes="512x512" />
  <link rel="apple-touch-icon" href="/icon-512.png" sizes="512x512" />
  <link rel="manifest" href="/manifest.webmanifest" />
  <meta name="theme-color" content="#b22222" />

  <!-- Font Awesome -->
  <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
        crossorigin="anonymous" referrerpolicy="no-referrer" />

  <!-- reCAPTCHA v2 -->
  <script src="https://www.google.com/recaptcha/api.js" async defer></script>

  <style>
    :root{ --shu:#e6462d; --border:#e5e7eb; --ink:#132c3a; --muted:#6b7280; }
    *{box-sizing:border-box}
    body{
      margin:0;background:#fff;color:var(--ink);
      font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans JP","Yu Gothic",Meiryo,sans-serif;
      line-height:1.7
    }
    a{color:inherit}
    ruby{ruby-position:over} rt{font-size:.65em;color:#6b7280;letter-spacing:0}

    .wrap{max-width:960px;margin:0 auto;padding:12px}

    /* ヘッダー/フッター */
    .topbar{
      border-top:4px solid var(--shu);
      border-bottom:1px solid #fee2e2;
      background:#fff;
    }
    .site-footer{
      border-top:1px solid #fee2e2;
      background:#fff;
    }
    .site-footer .wrap{
      padding:16px 0;
      display:flex;
      gap:10px;
      align-items:center;
      justify-content:center;
      color:#98a1a8;
      font-size:12px;
    }

    h1{font-size:28px;margin:16px 0}
    .card{border:1px solid var(--border);border-radius:12px;background:#fff;padding:16px 18px 14px}
    label{display:block;font-size:13px;color:var(--muted);margin:12px 0 6px}
    input,textarea{
      width:100%;padding:12px;border:1px solid var(--border);
      border-radius:10px;background:#fff;font:inherit
    }
    textarea{min-height:180px;resize:vertical}
    .row{display:flex;gap:10px;align-items:center;margin-top:12px;flex-wrap:wrap}
    .btn{
      padding:10px 16px;border-radius:10px;background:var(--shu);
      color:#fff;border:none;cursor:pointer
    }
    .btn.secondary{
      background:#fff;color:#111827;border:1px solid var(--border)
    }
    .note{font-size:12px;color:var(--muted);margin-top:8px}
    .msg-ok{color:#10b981;font-weight:700}
    .msg-ng{color:#ef4444;font-weight:700}

    /* inquiry では Learning/Learned を非表示 */
    nav[aria-label="Learning navigation"]{ display:none !important; }
  </style>

  <!-- GA4 -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-9QSHWJE0HZ"></script>
  <script>
    window.dataLayer=window.dataLayer||[];
    function gtag(){dataLayer.push(arguments);}
    gtag('js',new Date());
    gtag('config','G-9QSHWJE0HZ');
  </script>
</head>

<body>
<header class="topbar">
  <div id="site-header" class="wrap site-header" style="padding:12px 0;"></div>
</header>

<main>
  <div class="wrap">
    <h1 id="title" data-i18n="contact">Contact</h1>

    <section class="card" aria-labelledby="title">
      <iframe name="submit_iframe" id="submit_iframe" style="display:none"></iframe>

      <!-- ★ 既存の Apps Script URL をそのまま使用 -->
      <form id="contactForm" target="submit_iframe" method="POST"
            action="https://script.google.com/macros/s/AKfycbwclbSxz7fRO9PQwLIpbhFGVzhocuSNBx2Y8ITm0LkuJU1HCZz38vQYmyOlC1kY9Nrzcg/exec">

        <label for="name" id="lbName" data-i18n="name">Name</label>
        <input id="name" name="name" autocomplete="name" placeholder="Your name" />

        <label for="email" id="lbEmail" data-i18n="email">Email</label>
        <input id="email" name="email" type="email" autocomplete="email" placeholder="your@email.com" />

        <label for="subject" id="lbSubject" data-i18n="subject">Subject</label>
        <input id="subject" name="subject" placeholder="What is this about?" />

        <label for="message" id="lbMessage" data-i18n="message">Message</label>
        <textarea id="message" name="message" placeholder="Write your message..."></textarea>

        <input type="hidden" id="token" name="token" />

        <div class="row">
          <!-- ★sitekey は index(77) の内容をそのまま維持 -->
          <div class="g-recaptcha" data-sitekey="6LcRKvArAAAAAFVmY21y9o_hwTszHwzp3bgRXtBV"></div>

          <button type="button" class="btn secondary" id="btnCancel" data-i18n="cancel">Cancel</button>
          <button type="submit" class="btn" id="btnSend" data-i18n="send">Send</button>
        </div>

        <div class="note" id="rcNote">
          reCAPTCHA and Google’s
          <a href="https://policies.google.com/privacy?hl=en" target="_blank" rel="noopener">Privacy Policy</a> and
          <a href="https://policies.google.com/terms?hl=en" target="_blank" rel="noopener">Terms of Service</a> apply.
        </div>

        <div class="note" id="msg" aria-live="polite"></div>
      </form>
    </section>
  </div>
</main>

<footer class="site-footer">
  <div id="site-footer" class="wrap" style="padding-bottom:16px"></div>
</footer>

<!-- 共通パーシャル -->
<script src="/assets/partials.js"></script>

<script>
/* === 言語辞書 === */
const dict = {
  en:{
    contact:"Contact",name:"Name",email:"Email",subject:"Subject",message:"Message",
    cancel:"Cancel",send:"Send",
    placeholders:{name:"Your name",email:"your@email.com",subject:"What is this about?",
    message:"Write your message..."},
    need:"Please check the reCAPTCHA box.",
    sentok:"Your message has been sent. Thank you!",
    sentng:"Failed to send. Please try again later."
  },
  ja:{
    contact:"<ruby><rb>お問い合わせ</rb><rt>おといあわせ</rt></ruby>",
    name:"<ruby><rb>お名前</rb><rt>おなまえ</rt></ruby> / Name",
    email:"<ruby><rb>メール</rb><rt>めーる</rt></ruby> / Email",
    subject:"<ruby><rb>件名</rb><rt>けんめい</rt></ruby> / Subject",
    message:"<ruby><rb>メッセージ</rb><rt>めっせーじ</rt></ruby> / Message",
    cancel:"キャンセル",
    send:"送信",
    placeholders:{name:"おなまえ",email:"your@email.com",
    subject:"ご用件",message:"メッセージを入力してください"},
    need:"reCAPTCHA をチェックしてください。",
    sentok:"送信しました。ありがとうございます。",
    sentng:"送信に失敗しました。時間をおいてお試しください。"
  }
};

let lang = localStorage.getItem('nt_lang') ||
          ((navigator.language||'en').startsWith('ja') ? 'ja':'en');

const els = {
  title: document.getElementById('title'),
  lbName: document.getElementById('lbName'),
  lbEmail: document.getElementById('lbEmail'),
  lbSubject: document.getElementById('lbSubject'),
  lbMessage: document.getElementById('lbMessage'),
  btnCancel: document.getElementById('btnCancel'),
  btnSend: document.getElementById('btnSend'),
  name: document.getElementById('name'),
  email: document.getElementById('email'),
  subject: document.getElementById('subject'),
  message: document.getElementById('message'),
  msg: document.getElementById('msg'),
};

function applyLang(ctx){
  // ★ パーシャル側の現在言語を優先して取得
  lang = (ctx && ctx.lang) ||
         localStorage.getItem('nt_lang') ||
         lang || 'en';

  const t = dict[lang] || dict.en;

  els.title.innerHTML = t.contact;
  els.lbName.innerHTML = t.name;
  els.lbEmail.innerHTML = t.email;
  els.lbSubject.innerHTML = t.subject;
  els.lbMessage.innerHTML = t.message;
  els.btnCancel.textContent = t.cancel;
  els.btnSend.textContent = t.send;
  els.name.placeholder = t.placeholders.name;
  els.email.placeholder = t.placeholders.email;
  els.subject.placeholder = t.placeholders.subject;
  els.message.placeholder = t.placeholders.message;

  // <title> も切り替え
  const titleEl = document.querySelector('title');
  if(titleEl){
    titleEl.textContent =
      (lang === 'en') ? 'Contact | nihongotext.com' : 'お問い合わせ | nihongotext.com';
  }

  localStorage.setItem('nt_lang',lang);
}

/* === form送信 === */
const form = document.getElementById('contactForm');
const iframe = document.getElementById('submit_iframe');

iframe.addEventListener('load',()=>{
  const t=dict[lang] || dict.en;
  els.msg.innerHTML=t.sentok;
  els.msg.className='note msg-ok';
  form.reset();
  if(window.grecaptcha) grecaptcha.reset();
});

form.addEventListener('submit',ev=>{
  const t=dict[lang] || dict.en;
  const token=window.grecaptcha?grecaptcha.getResponse():'';
  if(!token){
    ev.preventDefault();
    els.msg.innerHTML=t.need;
    els.msg.className='note msg-ng';
    return;
  }
  document.getElementById('token').value=token;
});

/* === 初期化 === */
(function init(){
  if (window.injectPartials){
    // パーシャル読み込み（Learning/Learned 非表示）
    window.injectPartials({
      hideLearningNav:true,
      titleTargets:[
        {el:document.querySelector('#title'),en:'Contact',ja:'お問い合わせ'}
      ],
      titleDoc:{en:'Contact | nihongotext.com',ja:'お問い合わせ | nihongotext.com'},
      onLangApply:(currentLang)=>applyLang({lang:currentLang})
    });
  } else {
    // フォールバック：header/footer を直接読み込み
    const headerEl = document.getElementById('site-header');
    if(headerEl){
      fetch('/partials/header.html',{cache:'no-store'})
        .then(r=>r.ok?r.text():'')
        .then(html=>{ headerEl.innerHTML = html; })
        .catch(()=>{});
    }
    const footerEl = document.getElementById('site-footer');
    if(footerEl){
      fetch('/partials/footer.html',{cache:'no-store'})
        .then(r=>r.ok?r.text():'')
        .then(html=>{ footerEl.innerHTML = html; })
        .catch(()=>{
          footerEl.textContent = '© 2025 nihongotext.com';
        });
    }
    applyLang({lang});
  }
})();
</script>
</body>
</html>
