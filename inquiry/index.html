<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Contact | nihongotext.com</title>
  <link rel="icon" href="/favicon.ico" />
  <!-- /inquiry/配下でも全ての相対パスをサイトルート基準にする -->
  <base href="/" />

  <!-- GA4 -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-9QSHWJE0HZ"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){ dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'G-9QSHWJE0HZ');
  </script>

  <!-- reCAPTCHA v2 -->
  <script src="https://www.google.com/recaptcha/api.js" async defer></script>

  <style>
    :root{ --shu:#e6462d; --border:#e5e7eb; --ink:#132c3a; --muted:#6b7280; }
    *{box-sizing:border-box}
    body{
      margin:0;
      background:#fff;
      color:var(--ink);
      font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans JP","Yu Gothic",Meiryo,sans-serif;
      line-height:1.7;
    }
    a{color:inherit}
    ruby{ruby-position:over}
    rt{font-size:.65em;color:#6b7280;letter-spacing:0}

    .topbar{
      border-top:4px solid var(--shu);
      border-bottom:1px solid var(--border);
      background:#fff;
    }
    .wrap{
      max-width:960px;
      margin:0 auto;
      padding:12px 16px;
    }
    main .wrap{
      max-width:640px;
      padding:0;
    }
    .site-header nav[aria-label="Learning navigation"]{
      display:none !important;
    }

    h1{font-size:28px;margin:16px 0}
    .card{
      border:1px solid var(--border);
      border-radius:12px;
      background:#fff;
      padding:16px 18px 14px;
    }
    label{
      display:block;
      font-size:13px;
      color:var(--muted);
      margin:12px 0 6px;
    }
    input,textarea{
      width:100%;
      padding:12px;
      border:1px solid var(--border);
      border-radius:10px;
      background:#fff;
      font:inherit;
    }
    textarea{
      min-height:180px;
      resize:vertical;
    }
    .row{
      display:flex;
      gap:10px;
      align-items:center;
      margin-top:12px;
      flex-wrap:wrap;
    }
    .btn{
      padding:10px 16px;
      border-radius:10px;
      background:var(--shu);
      color:#fff;
      border:none;
      cursor:pointer;
    }
    .btn.secondary{
      background:#fff;
      color:#111827;
      border:1px solid var(--border);
    }
    .note{
      font-size:12px;
      color:var(--muted);
      margin-top:8px;
    }
    .msg-ok{color:#10b981;font-weight:700}
    .msg-ng{color:#ef4444;font-weight:700}
  </style>
</head>
<body>
  <header class="topbar">
    <div id="site-header" class="wrap site-header" style="padding:12px 0;"></div>
  </header>

  <main class="wrap">
  <div class="wrap" id="page" data-lang="en">
    <h1 id="title">Contact</h1>
    <div class="card">
      <form id="contactForm"
            method="GET"
            action="https://script.google.com/macros/s/AKfycbwOZYS2HD-rvYVGFMkKsgm0feGWxgFypjpPbhVE8LYgKJe1T3lXfkgDNAiKIjJZcZNdNA/exec">
        <label id="lbName" for="name">Name</label>
        <input id="name" name="name" type="text" required />

        <label id="lbEmail" for="email">Email</label>
        <input id="email" name="email" type="email" required />

        <label id="lbSubject" for="subject">Subject</label>
        <input id="subject" name="subject" type="text" required />

        <label id="lbMessage" for="body">Message</label>
        <textarea id="body" name="body" required></textarea>

        <input type="hidden" name="source" value="inquiry-page" />

        <div class="row">
          <div class="g-recaptcha"
               data-sitekey="6LcRKvArAAAAAMzm6vL2aE6DYqGrsTncc8mn_yEn"></div>
          <div id="rcNote" class="note">
            Please do not include passwords or highly confidential information.<br>
            We may introduce your question (anonymously) on our blog or Q&amp;A page.
          </div>
        </div>

        <div class="row">
          <button id="btnCancel" type="button" class="btn secondary">Cancel</button>
          <button id="btnSend" type="submit" class="btn">Send</button>
        </div>

        <p id="msg" class="note" aria-live="polite"></p>
      </form>
    </div>
  </div>
  </main>

  <footer class="site-footer">
    <div id="site-footer" class="wrap" style="padding-bottom:16px"></div>
  </footer>

  <script src="/assets/partials.js"></script>
  <script>
    (function() {
      const dict = {
        en: {
          contact: 'Contact',
          name: 'Name',
          email: 'Email',
          subject: 'Subject',
          message: 'Message',
          placeholders: {
            name: 'Your name',
            email: 'your@email.com',
            subject: 'Title of your message',
            message: 'Please write your question, feedback, or request here.'
          },
          note: 'Please do not include passwords or highly confidential information.',
          note2: 'We may introduce your question (anonymously) on our blog or Q&A page.',
          cancel: 'Cancel',
          send: 'Send',
          need: 'Please complete the reCAPTCHA.',
          sentok: 'Your message has been sent. Thank you.',
          sentng: 'Failed to send your message. Please try again later.'
        },
        ja: {
          contact: '<ruby><rb>お問い合わせ</rb><rt>おといあわせ</rt></ruby>',
          name: '<ruby><rb>お名前</rb><rt>おなまえ</rt></ruby>',
          email: 'メールアドレス',
          subject: '<ruby><rb>件名</rb><rt>けんめい</rt></ruby>',
          message: '<ruby><rb>本文</rb><rt>ほんぶん</rt></ruby>',
          placeholders: {
            name: 'お名前をご入力ください',
            email: 'your@email.com',
            subject: 'お問い合わせの件名',
            message: 'ご質問・ご意見・ご要望などをご自由にお書きください。'
          },
          note: 'パスワードなどの重要な情報は記載しないでください。',
          note2: 'いただいたご質問は、匿名の形でブログやQ&Aに掲載させていただくことがあります。',
          cancel: 'キャンセル',
          send: '送信',
          need: 'reCAPTCHA を完了してください。',
          sentok: '送信が完了しました。ありがとうございます。',
          sentng: '送信に失敗しました。時間をおいて再度お試しください。'
        }
      };

      let currentLang = (window.getLang ? window.getLang() : null)
        || (localStorage.getItem('lang') || ((navigator.language || 'en').startsWith('ja') ? 'ja' : 'en'));

      function applyLang(lang) {
        currentLang = lang || currentLang || 'en';
        const t = dict[currentLang] || dict.en;

        const page = document.getElementById('page');
        if (page) page.setAttribute('data-lang', currentLang);

        const title = document.getElementById('title');
        if (title) title.innerHTML = t.contact;

        const lbName   = document.getElementById('lbName');
        const lbEmail  = document.getElementById('lbEmail');
        const lbSubj   = document.getElementById('lbSubject');
        const lbMsg    = document.getElementById('lbMessage');
        if (lbName)  lbName.innerHTML  = t.name;
        if (lbEmail) lbEmail.innerHTML = t.email;
        if (lbSubj)  lbSubj.innerHTML  = t.subject;
        if (lbMsg)   lbMsg.innerHTML   = t.message;

        const nameEl = document.getElementById('name');
        const mailEl = document.getElementById('email');
        const subjEl = document.getElementById('subject');
        const msgEl  = document.getElementById('body');
        if (nameEl) nameEl.placeholder = t.placeholders.name;
        if (mailEl) mailEl.placeholder = t.placeholders.email;
        if (subjEl) subjEl.placeholder = t.placeholders.subject;
        if (msgEl) msgEl.placeholder   = t.placeholders.message;

        const note = document.getElementById('rcNote');
        if (note) note.innerHTML = t.note + '<br>' + t.note2;

        const bCancel = document.getElementById('btnCancel');
        const bSend   = document.getElementById('btnSend');
        if (bCancel) bCancel.textContent = t.cancel;
        if (bSend)   bSend.textContent   = t.send;
      }

      function setupFormHandling() {
        const form = document.getElementById('contactForm');
        if (!form) return;
        const msg = document.getElementById('msg');

        function setMessage(ok, key) {
          if (!msg) return;
          msg.className = 'note ' + (ok ? 'msg-ok' : 'msg-ng');
          const t = dict[currentLang] || dict.en;
          msg.textContent = t[key] || '';
        }

        form.addEventListener('submit', function(e) {
          e.preventDefault();

          if (window.grecaptcha) {
            const token = grecaptcha.getResponse();
            if (!token) {
              setMessage(false, 'need');
              return;
            }
          }

          const fd = new FormData(form);
          const params = new URLSearchParams(fd);
          let url = form.action;
          url += (url.indexOf('?') === -1 ? '?' : '&') + params.toString();

          const cbName = 'jsonp_' + Date.now() + '_' + Math.floor(Math.random() * 10000);
          const s = document.createElement('script');

          window[cbName] = function(res) {
            if (res && res.status === 'ok') {
              setMessage(true, 'sentok');
              form.reset();
              if (window.grecaptcha) grecaptcha.reset();
            } else {
              setMessage(false, 'sentng');
            }
            delete window[cbName];
            s.remove();
          };

          s.src = url + '&callback=' + cbName + '&_=' + Date.now();
          s.onerror = function() {
            setMessage(false, 'sentng');
            delete window[cbName];
            s.remove();
          };
          document.body.appendChild(s);
        });

        const btnCancel = document.getElementById('btnCancel');
        if (btnCancel) {
          btnCancel.addEventListener('click', function(e) {
            e.preventDefault();
            form.reset();
            if (msg) {
              msg.className = 'note';
              msg.textContent = '';
            }
            if (window.grecaptcha) grecaptcha.reset();
          });
        }
      }

      document.addEventListener('DOMContentLoaded', function() {
        if (window.injectPartials) {
          window.injectPartials({
            hideLearningNav: true,
            titleTargets: [
              {
                el: document.getElementById('title'),
                en: 'Contact',
                ja: '<ruby><rb>お問い合わせ</rb><rt>おといあわせ</rt></ruby>'
              }
            ],
            titleDoc: {
              en: 'Contact | nihongotext.com',
              ja: 'お問い合わせ | nihongotext.com'
            },
            onLangApply(lang) {
              applyLang(lang);
            }
          });
        } else {
          applyLang(currentLang);
        }

        setupFormHandling();
        applyLang(currentLang);
      });
    })();
  </script>
</body>
</html>
