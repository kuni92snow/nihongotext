<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Inquiry | nihongotext.com</title>
<meta name="color-scheme" content="light only" />

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />

<!-- GA4（トップと同一ID） -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-9QSHWJE0HZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-9QSHWJE0HZ', { send_page_view:false });
</script>

<style>
:root{
  --shu:#e6462d; --shu-deep:#c13727; --shu-tint:#fff2ef;
  --shu-soft:#ffb9aa; --white:#fff; --ink:#1f2937; --muted:#6b7280; --border:#efdfdc;
}
*{box-sizing:border-box}
html,body{margin:0;background:#fff;color:var(--ink);
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Noto Sans JP","Yu Gothic",Meiryo,sans-serif}
a{color:inherit;text-decoration:none}
.container{max-width:1100px;margin:0 auto;padding:0 16px}

/* Header */
header{border-bottom:3px solid var(--shu);background:#fff}
.h-row{display:flex;align-items:center;justify-content:space-between;padding:10px 0}
header .container.positioned{position:relative}
.brand{display:flex;flex-direction:column;gap:2px}
.brand a.brand-link{display:inline-block}
.brand-title{font-weight:980;letter-spacing:.3px;font-size:clamp(24px,4.2vw,32px);color:var(--shu)}
.brand-sub{width:fit-content;margin:0 auto;color:var(--shu-soft);font-weight:700;font-size:12px;letter-spacing:.4px}
.iconbar{display:flex;gap:10px;flex-wrap:wrap;justify-content:center}
.iconbar .tool{display:inline-flex;width:38px;height:38px;align-items:center;justify-content:center;border-radius:50%;
  border:1px solid var(--border);background:#fff}
.iconbar .tool i{color:var(--shu)}
.iconbar .tool:hover{border-color:var(--shu)}

/* 言語切替（右端固定） */
.lang-switch{
  position:absolute; right:16px; top:12px;
  display:flex; gap:8px; align-items:center;
}
.lang-switch button{
  border:1px solid var(--border); background:#fff; color:#333;
  padding:6px 10px; border-radius:999px; cursor:pointer;
}
.lang-switch button.active{border-color:var(--shu); color:var(--shu-deep)}

/* main & form */
main{max-width:900px;margin:14px auto 24px;padding:0 16px}
.card{border:1px solid var(--border);border-radius:12px;background:#fff;box-shadow:0 2px 12px rgba(230,70,45,.06)}
.card .hd{padding:14px 16px;border-bottom:1px solid var(--border);background:var(--shu-tint);font-weight:700}
.card .bd{padding:16px}
.form-row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
.form-row.single{grid-template-columns:1fr}
.input, textarea, select{
  width:100%; padding:10px 12px; border:1px solid var(--border); border-radius:10px; background:#fff;
}
label{font-size:13px;color:var(--muted);display:block;margin:6px 0 4px}
.help{font-size:12px;color:var(--muted);margin-top:6px}

/* ボタン */
.btn{padding:10px 14px;border-radius:12px;border:1px solid var(--shu);background:#fff;cursor:pointer}
.btn.ok{background:var(--shu);color:#fff}
.btn:disabled{opacity:.6;cursor:not-allowed}

/* footer */
footer{border-top:3px solid var(--shu);margin-top:24px;background:#fff}
.f-row{display:flex;flex-direction:column;gap:8px;align-items:center;justify-content:center;padding:12px 0}
.copy{color:#6b7280}
</style>
</head>
<body>
<header>
  <div class="container h-row positioned">
    <div class="brand">
      <a class="brand-link" href="/" aria-label="トップへ">
        <div class="brand-title">nihongotext<span style="color:var(--shu-deep)">.com</span></div>
        <div class="brand-sub">== beta version ==</div>
      </a>
    </div>
    <!-- 言語切替（右端） -->
    <div class="lang-switch" role="group" aria-label="Language">
      <button id="btnJa" class="active">日本語</button>
      <button id="btnEn">English</button>
    </div>
  </div>

  <!-- アイコンバー -->
  <div class="container">
    <nav class="iconbar" aria-label="site icons">
      <a class="tool" title="トップへ" href="/"><i class="fas fa-house"></i></a>
      <a class="tool" title="お知らせ（ブログ）" href="/blog/"><i class="fas fa-bell"></i></a>
      <a class="tool" title="Reddit" target="_blank" href="https://reddit.com/r/nihongotext"><i class="fab fa-reddit"></i></a>
      <a class="tool" title="Medium" target="_blank" href="https://medium.com/@nihongotext"><i class="fab fa-medium"></i></a>
      <a class="tool" title="Substack" target="_blank" href="https://substack.com/@nihongotext"><i class="fas fa-envelope-open-text"></i></a>
    </nav>
  </div>
</header>

<main>
  <section class="card">
    <div class="hd" id="formTitle">お問い合わせ</div>
    <div class="bd">
      <form id="inqForm" novalidate>
        <div class="form-row">
          <div>
            <label id="lblName">お名前</label>
            <input id="name" class="input" type="text" autocomplete="name" required>
          </div>
          <div>
            <label id="lblEmail">メール</label>
            <input id="email" class="input" type="email" autocomplete="email">
          </div>
        </div>
        <div class="form-row">
          <div>
            <label id="lblSubject">件名</label>
            <input id="subject" class="input" type="text">
          </div>
          <div>
            <label id="lblCategory">カテゴリ</label>
            <select id="category" class="input">
              <option value="general">一般</option>
              <option value="bug">不具合</option>
              <option value="request">要望</option>
            </select>
          </div>
        </div>
        <div class="form-row single">
          <div>
            <label id="lblMessage">内容</label>
            <textarea id="message" class="input" rows="6" required></textarea>
          </div>
        </div>

        <!-- reCAPTCHA v2（チェックボックス） -->
        <div style="margin:10px 0">
          <!-- ✅ 正しい v2/Checkbox の Site key をセット済み -->
          <div id="recaptchaMount" class="g-recaptcha" data-sitekey="6LcRKvArAAAAAFVmY21y9o_hwTszHwzp3bgRXtBV"></div>
        </div>

        <div class="help" id="policyText">
          送信すると、<a href="/privacy" target="_blank">プライバシーポリシー</a> と
          <a href="/terms" target="_blank">利用規約</a> に同意したものとみなされます。
        </div>

        <div style="display:flex;gap:10px;align-items:center;margin-top:12px">
          <button id="btnSend" class="btn ok" type="submit">送信</button>
          <span id="formNote" class="help"></span>
        </div>
      </form>
    </div>
  </section>
</main>

<footer>
  <div class="container f-row">
    <nav class="iconbar" aria-label="site icons">
      <a class="tool" title="トップへ" href="/"><i class="fas fa-house"></i></a>
      <a class="tool" title="お知らせ（ブログ）" href="/blog/"><i class="fas fa-bell"></i></a>
      <a class="tool" title="Reddit" target="_blank" href="https://reddit.com/r/nihongotext"><i class="fab fa-reddit"></i></a>
      <a class="tool" title="Medium" target="_blank" href="https://medium.com/@nihongotext"><i class="fab fa-medium"></i></a>
      <a class="tool" title="Substack" target="_blank" href="https://substack.com/@nihongotext"><i class="fas fa-envelope-open-text"></i></a>
    </nav>
    <div class="copy">© 2025 nihongotext.com</div>
  </div>
</footer>

<!-- ===== JS ===== -->
<script>
/* ===== 設定 ===== */
// JSONP 固定 GAS（/exec）URL：必要なら置き換え
const GAS_JSONP = "https://script.google.com/macros/s/AKfycbzyHV_NSyJU-hPwvJU5JJMMuPAa7V3vhmRuq6Clq7WBIErCx6A2xHgG1SXtSlfmR42OHw/exec";

/* GA page_view */
(function(){
  if (!window.gtag) return;
  gtag('event','page_view',{page_title:document.title,page_path:location.pathname + location.search});
})();

/* ===== i18n ===== */
const i18n = {
  ja: {
    title:'お問い合わせ', name:'お名前', email:'メール', subject:'件名', category:'カテゴリ',
    msg:'内容', send:'送信',
    policy:'送信すると、<a href="/privacy" target="_blank">プライバシーポリシー</a> と <a href="/terms" target="_blank">利用規約</a> に同意したものとみなされます。',
    cat:{general:'一般', bug:'不具合', request:'要望'},
    note_sending:'送信しています…', note_ok:'送信しました。ありがとうございます。',
    note_captcha:'reCAPTCHA を完了してください。'
  },
  en: {
    title:'Contact', name:'Name', email:'Email', subject:'Subject', category:'Category',
    msg:'Message', send:'Send',
    policy:'By submitting, you agree to our <a href="/privacy" target="_blank">Privacy Policy</a> and <a href="/terms" target="_blank">Terms of Service</a>.',
    cat:{general:'General', bug:'Bug report', request:'Feature request'},
    note_sending:'Sending…', note_ok:'Sent. Thank you!',
    note_captcha:'Please complete reCAPTCHA.'
  }
};
let currentLang = 'ja';
let recaptchaWidgetId = null;

/* reCAPTCHA を明示レンダー（言語切替に対応） */
function loadRecaptcha(hl){
  // 古いスクリプトを除去
  document.querySelectorAll('script[src*="google.com/recaptcha/api.js"]').forEach(s=>s.remove());
  // mountリセット
  const mount = document.getElementById('recaptchaMount');
  const sitekey = mount.getAttribute('data-sitekey'); // ← この Site key を使用
  mount.innerHTML = '';
  // onloadコールバックで explicit render
  const s=document.createElement('script');
  s.src = 'https://www.google.com/recaptcha/api.js?onload=__re_onload&render=explicit&hl=' + encodeURIComponent(hl||'ja');
  s.async = true; s.defer = true;
  window.__re_onload = function(){
    try{
      recaptchaWidgetId = grecaptcha.render('recaptchaMount', { sitekey });
    }catch(_){}
  };
  document.head.appendChild(s);
}

/* ラベル等の反映 */
function applyLang(lang){
  currentLang = lang;
  document.documentElement.lang = lang === 'ja' ? 'ja' : 'en';
  document.getElementById('btnJa').classList.toggle('active', lang==='ja');
  document.getElementById('btnEn').classList.toggle('active', lang==='en');

  const t=i18n[lang];
  document.getElementById('formTitle').textContent = t.title;
  document.getElementById('lblName').textContent  = t.name;
  document.getElementById('lblEmail').textContent = t.email;
  document.getElementById('lblSubject').textContent = t.subject;
  document.getElementById('lblCategory').textContent = t.category;
  document.getElementById('lblMessage').textContent = t.msg;
  document.getElementById('btnSend').textContent = t.send;
  document.getElementById('policyText').innerHTML = t.policy;

  const cat = document.getElementById('category');
  cat.options[0].text = t.cat.general;
  cat.options[1].text = t.cat.bug;
  cat.options[2].text = t.cat.request;

  // reCAPTCHA言語切替
  loadRecaptcha(lang === 'en' ? 'en' : 'ja');
}

/* 言語ボタン */
document.getElementById('btnJa').addEventListener('click', ()=>applyLang('ja'));
document.getElementById('btnEn').addEventListener('click', ()=>applyLang('en'));

/* ==== 送信（JSONP：GET /exec?mode=contact_submit ...） ==== */
function jsonp(url, params, cb){
  const name = '__cb_' + Math.random().toString(36).slice(2);
  params = params || {};
  params.callback = name;
  const qs = Object.keys(params).map(k=> k + '=' + encodeURIComponent(params[k])).join('&');
  const s = document.createElement('script');
  s.src = url + (url.indexOf('?')>=0 ? '&' : '?') + qs;
  window[name] = function(resp){
    try{ cb && cb(resp||{}); } finally {
      delete window[name];
      s.remove();
    }
  };
  document.body.appendChild(s);
}

document.getElementById('inqForm').addEventListener('submit', function(e){
  e.preventDefault();
  const note = document.getElementById('formNote');
  const t = i18n[currentLang];
  note.textContent = t.note_sending;

  // reCAPTCHA トークン取得
  const token = grecaptcha.getResponse(recaptchaWidgetId);
  if (!token) { note.textContent = t.note_captcha; return; }

  const params = {
    mode: 'contact_submit',
    name:    document.getElementById('name').value.trim(),
    email:   document.getElementById('email').value.trim(),
    subject: document.getElementById('subject').value.trim(),
    // 件名/カテゴリ/本文を連結して message に格納（GAS は message を読む）
    message: [
      'Subject: ' + (document.getElementById('subject').value.trim() || '(no subject)'),
      'Category: ' + document.getElementById('category').value,
      '',
      document.getElementById('message').value.trim()
    ].join('\n'),
    token:   token
  };

  jsonp(GAS_JSONP, params, function(res){
    if (res && res.ok) {
      note.textContent = t.note_ok;
      document.getElementById('inqForm').reset();
      grecaptcha.reset(recaptchaWidgetId);
    } else {
      note.textContent = (res && res.reason) ? ('送信失敗: ' + res.reason) : '送信に失敗しました。';
    }
  });
});

/* 初期化 */
applyLang('ja');
</script>
</body>
</html>
