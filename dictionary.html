<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>nihongotext.com - Vocabulary Tool</title>

<link rel="icon" href="/favicon.ico" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">

<script async src="https://www.googletagmanager.com/gtag/js?id=G-9QSHWJE0HZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-9QSHWJE0HZ', { send_page_view:false });
</script>

<style>
:root{ --shu:#e6462d; --shu-tint:#fff2ef; --ink:#1f2937; --muted:#6b7280; --line:#e5e7eb; --card:#fff7f6; }
*{box-sizing:border-box}
html,body{ margin:0;background:#fff;color:var(--ink);
  font:16px/1.65 system-ui,-apple-system,sans-serif }
a{color:inherit;text-decoration:none}
button{cursor:pointer; font-family:inherit;}

.wrap{max-width:1100px;margin:0 auto;padding:0 16px}

/* Header */
.topbar{border-top:4px solid var(--shu);border-bottom:1px solid var(--shu-tint);background:#fff;padding:15px 0}
.brandbar{display:flex;flex-direction:column;align-items:center;text-align:center}
.brand{font-weight:900;font-size:32px;color:var(--shu);text-decoration:none}
nav{display:flex;justify-content:center;gap:15px;margin-top:10px;flex-wrap:wrap}
nav a{color:var(--ink);font-weight:600;font-size:14px}
nav a:hover{color:var(--shu)}

/* Controls */
.controls{background:#f9fafb;padding:20px;border-radius:15px;margin:20px 0;border:1px solid var(--line)}
.search-group{display:flex;gap:10px;margin-bottom:15px}
input[type="text"]{flex:1;height:45px;border:1px solid var(--line);border-radius:10px;padding:0 15px;font-size:16px}
select{height:45px;border:1px solid var(--line);border-radius:10px;padding:0 10px;background:#fff}

.chips{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
.chip{border:1px solid var(--line);background:#fff;border-radius:999px;padding:6px 14px;font-size:13px;font-weight:700;color:var(--muted)}
.chip.active{border-color:var(--shu);background:var(--shu-tint);color:var(--shu)}

/* Grid */
.grid{display:grid;grid-template-columns:repeat(auto-fill, minmax(300px, 1fr));gap:15px;margin-bottom:40px}
.card{background:var(--card);border:1px solid #f1cbc6;border-radius:14px;padding:15px;transition:transform 0.2s}
.card:hover{transform:translateY(-2px);box-shadow:0 4px 12px rgba(0,0,0,0.05)}
.card-head{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:8px}
.tag{font-size:11px;font-weight:800;background:#fff;border:1px solid #f1cbc6;padding:2px 8px;border-radius:6px;color:var(--muted);text-transform:uppercase}
.ja{font-size:20px;font-weight:800;color:var(--ink);display:block}
.kana{font-size:14px;color:var(--muted);display:block;margin-bottom:4px}
.en{font-size:16px;color:var(--ink);border-top:1px dashed #f1cbc6;padding-top:8px;margin-top:8px;display:block}

/* Footer */
.footer{border-top:1px solid var(--shu-tint);padding:30px 0;text-align:center;color:var(--muted);font-size:12px}

/* Utils */
.status-msg{margin:10px 0;font-size:14px;color:var(--muted)}
mark{background:#fff176;color:#000;padding:0 2px;border-radius:2px}
</style>
</head>
<body>

<header class="topbar">
  <div class="wrap brandbar">
    <a href="/" class="brand">nihongotext<span style="color:var(--ink)">.com</span></a>
    <nav>
      <a href="/">Home</a>
      <a href="/dictionary.html" style="color:var(--shu)">Vocabulary Tool</a>
      <a href="/blog/index.html">Blog</a>
      <a href="/inquiry/index.html">Inquiry</a>
    </nav>
  </div>
</header>

<main class="wrap">
  <div class="controls">
    <div class="search-group">
      <select id="levelSel">
        <option value="N5">N5</option>
        <option value="N4">N4</option>
        <option value="N3">N3</option>
        <option value="N2">N2</option>
        <option value="N1">N1</option>
      </select>
      <input id="kw" type="text" placeholder="Search words (e.g. sushi, 食べる, eki)..." autocomplete="off" />
    </div>
    
    <div class="chips" id="posChips">
      <button class="chip active" data-pos="all">All Categories</button>
      <button class="chip" data-pos="nouns">Nouns</button>
      <button class="chip" data-pos="verbs">Verbs</button>
      <button class="chip" data-pos="adjectives-i">i-Adj</button>
      <button class="chip" data-pos="adjectives-na">na-Adj</button>
      <button class="chip" data-pos="adverbs">Adverbs</button>
      <button class="chip" data-pos="particles">Particles</button>
      <button class="chip" data-pos="numerals">Numerals</button>
      <button class="chip" data-pos="conjunctions">Conj</button>
    </div>
  </div>

  <div id="status" class="status-msg"></div>
  <div id="list" class="grid"></div>
</main>

<footer class="footer">
  <div class="wrap">© 2026 nihongotext.com</div>
</footer>

<script>
const LEVELS = ['N5','N4','N3','N2','N1'];
const POS_LIST = [
  {id:'nouns', file:'nouns.json', label:'Nouns'},
  {id:'verbs', file:'verbs.json', label:'Verbs'},
  {id:'adjectives-i', file:'adjectives-i.json', label:'i-Adjective'},
  {id:'adjectives-na', file:'adjectives-na.json', label:'na-Adjective'},
  {id:'adverbs', file:'adverbs.json', label:'Adverbs'},
  {id:'particles', file:'particles.json', label:'Particles'},
  {id:'conjunctions', file:'conjunctions.json', label:'Conjunctions'},
  {id:'interjections', file:'interjections.json', label:'Interjections'},
  {id:'numerals', file:'numerals.json', label:'Numerals'},
  {id:'patterns', file:'patterns.json', label:'Patterns'}
];

async function fetchJson(lv, fileName) {
  try {
    const res = await fetch(`/data/json/${lv}/${fileName}`);
    if (!res.ok) return [];
    const data = await res.json();
    // 配列ならそのまま、オブジェクトで entries があればそれを返す
    return Array.isArray(data) ? data : (data.entries || []);
  } catch(e) { 
    return []; 
  }
}

async function performSearch() {
  const kwInput = document.getElementById('kw');
  const levelSel = document.getElementById('levelSel');
  const listEl = document.getElementById('list');
  const statusEl = document.getElementById('status');
  
  const query = kwInput.value.trim().toLowerCase();
  const selectedLevel = levelSel.value;
  const activeChip = document.querySelector('.chip.active');
  const selectedPos = activeChip ? activeChip.dataset.pos : 'all';

  listEl.innerHTML = '';
  statusEl.textContent = 'Searching...';

  let allMatches = [];

  // 検索範囲の決定
  const levelsToSearch = query ? LEVELS : [selectedLevel];
  const posToSearch = (selectedPos === 'all') ? POS_LIST : POS_LIST.filter(p => p.id === selectedPos);

  for (const lv of levelsToSearch) {
    for (const pos of posToSearch) {
      const items = await fetchJson(lv, pos.file);
      const matches = items.filter(item => {
        if (!query) return true; // 検索語がない場合はそのレベルの全表示
        return (
          (item.ja && item.ja.includes(query)) ||
          (item.kana && item.kana.includes(query)) ||
          (item.en && item.en.toLowerCase().includes(query)) ||
          (item.ro && item.ro.toLowerCase().includes(query))
        );
      });

      matches.forEach(item => {
        allMatches.push({ ...item, lv, category: pos.label });
      });
    }
  }

  // 表示
  if (allMatches.length === 0) {
    statusEl.textContent = 'No results found.';
    return;
  }

  statusEl.textContent = `Found ${allMatches.length} items.`;
  
  allMatches.forEach(item => {
    const card = document.createElement('div');
    card.className = 'card';
    card.innerHTML = `
      <div class="card-head">
        <span class="tag">${item.lv} | ${item.category}</span>
        <small style="color:var(--muted)">${item.id || ''}</small>
      </div>
      <span class="ja">${item.ja}</span>
      <span class="kana">${item.kana || ''}</span>
      <span class="en">${item.en}</span>
    `;
    listEl.appendChild(card);
  });
}

// 初期化
(async function init() {
  const kwInput = document.getElementById('kw');
  const levelSel = document.getElementById('levelSel');
  const posChips = document.getElementById('posChips');

  // チップのクリックイベント
  posChips.addEventListener('click', (e) => {
    if (e.target.classList.contains('chip')) {
      document.querySelectorAll('.chip').forEach(c => c.classList.remove('active'));
      e.target.classList.add('active');
      performSearch();
    }
  });

  // レベル変更
  levelSel.addEventListener('change', performSearch);

  // 入力検索 (デバウンス)
  let timer;
  kwInput.addEventListener('input', () => {
    clearTimeout(timer);
    timer = setTimeout(performSearch, 400);
  });

  // URLパラメータ (?kw=...) 対応
  const params = new URLSearchParams(window.location.search);
  const query = params.get('kw');
  if (query) {
    kwInput.value = decodeURIComponent(query);
    performSearch();
  } else {
    // 初期表示
    performSearch();
  }
})();
</script>
</body>
</html>
