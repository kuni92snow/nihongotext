<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>nihongotext.com - Dictionary Tool</title>

<link rel="icon" href="/favicon.ico" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">

<style>
:root{ --shu:#e6462d; --shu-tint:#fff2ef; --ink:#1f2937; --muted:#6b7280; --line:#e5e7eb; --card:#fff7f6; }
*{box-sizing:border-box}
html,body{ margin:0;background:#fff;color:var(--ink);
  font:16px/1.65 system-ui,-apple-system,sans-serif }
a{color:inherit;text-decoration:none}
.wrap{max-width:1100px;margin:0 auto;padding:0 16px}

/* Header */
.topbar{border-top:4px solid var(--shu);border-bottom:1px solid var(--shu-tint);background:#fff;padding:15px 0}
.brand{font-weight:900;font-size:32px;color:var(--shu);text-align:center;display:block}

/* Controls */
.controls{display:flex;gap:10px;align-items:center;flex-wrap:wrap;margin:20px 0}
input[type="text"]{height:45px;border:1px solid var(--line);border-radius:10px;padding:0 15px;flex-grow:1;font-size:16px}
.grid{display:grid;grid-template-columns:repeat(auto-fill, minmax(300px, 1fr));gap:15px}
.card{background:var(--card);border:1px solid #f1cbc6;border-radius:12px;padding:15px}
.ja{font-size:20px;font-weight:800;color:var(--shu);display:block}
.en{color:var(--ink);margin-top:5px;display:block}
.tag{font-size:12px;color:var(--muted);background:#fff;border:1px solid var(--line);padding:2px 8px;border-radius:5px;margin-bottom:8px;display:inline-block}

/* ハイライト */
mark{background:#fff176;color:#000;padding:0 2px;border-radius:2px}
</style>
</head>
<body>

<header class="topbar">
  <div class="wrap">
    <a href="/" class="brand">nihongotext<span style="color:var(--ink)">.com</span></a>
    <nav style="display:flex;justify-content:center;gap:15px;margin-top:10px;">
      <a href="/">Home</a>
      <a href="/dictionary.html" style="font-weight:bold;color:var(--shu)">Vocabulary Tool</a>
      <a href="/blog/index.html">Blog</a>
    </nav>
  </div>
</header>

<main class="wrap">
  <div class="controls">
    <input id="kw" type="text" placeholder="Type a word to search (e.g. sushi, いくら)..." />
  </div>

  <div id="status" style="margin-bottom:10px; color:var(--muted); font-size:14px;"></div>
  <div id="list" class="grid">
    </div>
</main>

<script>
const LEVELS = ['N5','N4','N3','N2','N1'];
const FILES = [
  {type:'Nouns', name:'nouns.json'},
  {type:'Verbs', name:'verbs.json'},
  {type:'Adjectives', name:'adjectives-i.json'},
  {type:'Adjectives', name:'adjectives-na.json'},
  {type:'Particles', name:'particles.json'},
  {type:'Numerals', name:'numerals.json'}
];

async function fetchJson(path) {
  try {
    const res = await fetch(path);
    return res.ok ? await res.json() : [];
  } catch(e) { return []; }
}

async function performGlobalSearch(keyword) {
  const listEl = document.getElementById('list');
  const statusEl = document.getElementById('status');
  const kw = keyword.toLowerCase().trim();
  
  if(!kw) {
    listEl.innerHTML = '<p>Please enter a word to search.</p>';
    return;
  }

  statusEl.textContent = `Searching for "${keyword}"...`;
  listEl.innerHTML = '';
  
  let foundCount = 0;
  
  // 全レベル・全ファイルを横断検索
  for (const lv of LEVELS) {
    for (const file of FILES) {
      const data = await fetchJson(`/data/json/${lv}/${file.name}`);
      const matches = data.filter(item => 
        (item.ja && item.ja.includes(kw)) || 
        (item.en && item.en.toLowerCase().includes(kw)) ||
        (item.kana && item.kana.includes(kw)) ||
        (item.ro && item.ro.toLowerCase().includes(kw))
      );

      if (matches.length > 0) {
        matches.forEach(item => {
          foundCount++;
          const card = document.createElement('div');
          card.className = 'card';
          card.innerHTML = `
            <span class="tag">${lv} | ${file.type}</span>
            <span class="ja">${item.ja} <small style="font-weight:normal;color:#666">(${item.kana || ''})</small></span>
            <span class="en">${item.en}</span>
          `;
          listEl.appendChild(card);
        });
      }
    }
  }

  statusEl.textContent = foundCount > 0 
    ? `Found ${foundCount} results for "${keyword}".`
    : `No results found for "${keyword}".`;
}

// 初期化
(async function init() {
  const kwInput = document.getElementById('kw');
  
  // 入力時の検索（少し遅延させて負荷軽減）
  let timer;
  kwInput.addEventListener('input', () => {
    clearTimeout(timer);
    timer = setTimeout(() => performGlobalSearch(kwInput.value), 500);
  });

  // URLパラメータのチェック
  const params = new URLSearchParams(window.location.search);
  const query = params.get('kw');
  if (query) {
    kwInput.value = decodeURIComponent(query);
    performGlobalSearch(query);
  }
})();
</script>
</body>
</html>
