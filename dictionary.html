<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>nihongotext.com　==beta version==</title>

<link rel="icon" href="/favicon.ico" />
<link rel="icon" type="image/png" href="/icon-512.png" sizes="512x512">
<link rel="apple-touch-icon" href="/icon-512.png" sizes="512x512">
<link rel="manifest" href="/manifest.webmanifest">
<meta name="theme-color" content="#b22222">

<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">

<script async src="https://www.googletagmanager.com/gtag/js?id=G-9QSHWJE0HZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-9QSHWJE0HZ', { send_page_view:false });
</script>

<style>
:root{ --shu:#e6462d; --shu-tint:#fff2ef; --ink:#1f2937; --muted:#6b7280; --line:#e5e7eb; --card:#fff7f6; }
*{box-sizing:border-box}
html,body{ margin:0;background:#fff;color:var(--ink);
  font:16px/1.65 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Noto Sans JP","Hiragino Kaku Gothic ProN","Yu Gothic UI","Meiryo",sans-serif }
a{color:inherit;text-decoration:none} button{cursor:pointer}

/* Header */
.topbar{border-top:4px solid var(--shu);border-bottom:1px solid var(--shu-tint);background:#fff}
.wrap{max-width:1100px;margin:0 auto;padding:0 16px}

.brandbar{
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  padding:14px 0;
  text-align:center;
}
.brand{font-weight:900;font-size:40px;color:var(--shu);}
.small-dot{color:var(--ink)}
.beta{color:var(--muted);font-size:12px;margin-top:4px}

.learning-buttons{
  margin-top:8px;
  display:flex;
  gap:8px;
  justify-content:center;
}

.btn{border:1px solid var(--shu);color:var(--shu);background:#fff;border-radius:10px;padding:8px 12px;font-weight:700}

/* Controls */
.controls{display:flex;gap:10px;align-items:center;flex-wrap:wrap;margin:18px 0}
select,input[type="text"]{height:40px;border:1px solid var(--line);border-radius:10px;padding:0 12px;background:#fff}
.grow{flex:1}
.chips{display:flex;gap:8px;flex-wrap:wrap}
.chip{border:1px solid var(--line);background:#f8fafc;border-radius:999px;padding:8px 12px;font-weight:700}
.chip.active{border-color:var(--shu);background:#fde3df}
.toggle-row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
.toggle-row label{display:inline-flex;gap:6px;align-items:center;border:1px solid var(--line);padding:6px 10px;border-radius:10px;background:#fff}

/* Cards */
.grid{display:grid;grid-template-columns:1fr;gap:12px}
.card{background:var(--card);border:1px solid #f1cbc6;border-radius:14px;overflow:hidden}
.card.learned{background:#eefbf1;border-color:#cceedd}
.card.learning{background:#f0fff4;border-color:#34d399}

.head{display:flex;gap:10px;align-items:center;padding:10px 12px;background:#fff;border-bottom:1px dashed #f0d7d4}
.num{font-weight:800;color:var(--shu)}
.tags{display:flex;gap:6px;flex-wrap:wrap}
.tag{font-size:13px;background:#fff;border:1px solid #f0d7d4;border-radius:8px;padding:3px 8px}
.content{padding:12px 14px}
.line{margin:6px 0}
.ja{font-weight:800}

.toggle-btn{border:none;background:none;color:var(--shu);cursor:pointer;width:22px;height:22px;font-size:16px;line-height:1;display:inline-flex;align-items:center;justify-content:center}

/* Pager */
.pager{display:flex;gap:8px;align-items:center;justify-content:center;margin:16px 0 10px}
.pagebtn{border:1px solid var(--line);background:#fff;border-radius:8px;padding:6px 10px}
.pagebtn.active{border-color:var(--shu);color:var(--shu);font-weight:800}

/* Footer */
.footer{border-top:1px solid var(--shu-tint);background:#fff}
.footer-inner{padding:16px 0;display:flex;gap:10px;align-items:center;justify-content:center;color:#98a1a8;font-size:12px}

/* Popup base */
.mask{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.45);z-index:90}
.mask.show{display:flex}
.win{
  background:#fff;
  border-radius:12px;
  max-width:820px;
  width:min(96vw,820px);
  padding:12px;
  border:2px solid var(--shu);
  max-height:80vh;
  overflow-y:auto;
}
.win .x{float:right;border:1px solid var(--shu);color:var(--shu);background:#fff;border-radius:8px;padding:4px 9px}

/* Floating Quiz Button */
.floating-quiz-btn{
  position:fixed;
  right:20px;
  bottom:80px;
  width:52px;
  height:52px;
  border-radius:999px;
  border:none;
  background:#ff5722;
  color:#fff;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:22px;
  box-shadow:0 4px 12px rgba(0,0,0,.25);
  z-index:2000;
  transition:transform .15s ease, box-shadow .15s ease, background .15s ease;
}
.floating-quiz-btn:hover{
  transform:translateY(-2px);
  box-shadow:0 6px 16px rgba(0,0,0,.3);
  background:#ff784e;
}

/* 検索ヒットのハイライト */
.search-hit { background: #fff176; color: #000; padding: 0 2px; border-radius: 2px; font-weight: bold; }
</style>
</head>
<body>

<div class="topbar">
  <div id="site-header" class="wrap brandbar">
    <a href="/" class="brand">nihongotext<span class="small-dot">.com</span></a>
    <span class="beta">== beta version ==</span>

    <div class="learning-buttons">
      <button id="learningBtn" class="btn" type="button">Learning</button>
      <button id="learnedBtn" class="btn" type="button">Learned</button>
    </div>

    <nav style="display:flex;align-items:center;gap:14px;flex-wrap:wrap;justify-content:center;margin-top:8px;">
      <a href="/" style="color:#333;text-decoration:none;font-weight:bold;">Home</a>
      <a href="/blog/index.html" style="color:#333;text-decoration:none;">Blog</a>
      <a href="/inquiry/index.html" style="color:#333;text-decoration:none;">Inquiry</a>
      <a href="/legal.html" style="color:#333;text-decoration:none;">Legal</a>
      <a href="/privacy.html" style="color:#333;text-decoration:none;">Privacy</a>
    </nav>
  </div>
</div>

<main class="wrap">
  <div class="controls">
    <label>Level
      <select id="levelSel">
        <option>N5</option><option>N4</option><option>N3</option><option>N2</option><option>N1</option>
      </select>
    </label>

    <div class="chips" id="posChips" role="tablist" aria-label="Parts of Speech"></div>

    <input id="kw" class="grow" type="text" placeholder="Search across all levels & parts…" />

    <div class="toggle-row" id="viewToggles" aria-label="View toggles">
      <label><input type="checkbox" id="toggleJA" checked> Nihongo</label>
      <label><input type="checkbox" id="toggleKANA" checked> Hiragana</label>
      <label><input type="checkbox" id="toggleRO" checked> Alphabet</label>
      <label><input type="checkbox" id="toggleEN" checked> English</label>
    </div>
  </div>

  <div id="meta" style="color:var(--muted);font-size:13px;margin:4px 0 10px"></div>
  <div id="list" class="grid" aria-live="polite"></div>
  <div id="pager" class="pager"></div>
</main>

<button id="floatingQuizBtn" class="floating-quiz-btn" aria-label="Open quiz">Quiz</button>

<div class="footer">
  <div id="site-footer" class="wrap footer-inner">© 2026 nihongotext.com</div>
</div>

<div id="learnedModal" class="mask"><div class="win"><button class="x" id="closeLearned">×</button><h3 id="learnedTitle">Learned</h3><div id="learnedBody"></div><div id="learnedPager" class="pager"></div></div></div>
<div id="learningModal" class="mask"><div class="win"><button class="x" id="closeLearning">×</button><h3>Learning</h3><div id="learningBody"></div><div id="learningPager" class="pager"></div></div></div>
<div id="adModal" class="mask" aria-hidden="true"><div class="win" style="max-width:560px"><button class="x" id="adClose">×</button><h3>Sponsored</h3><p>Check out 1-on-1 online lessons.</p><a id="adLink" href="#" target="_blank" class="btn">Explore</a></div></div>

<script>
/* 基本設定とデータロードロジック（省略なしで実装を維持） */
const LEVELS = ['N5','N4','N3','N2','N1'];
const POS = [
  {k:'nouns', file:'nouns.json', ja:'名詞', enLabel:'Nouns'},
  {k:'verbs', file:'verbs.json', ja:'動詞', enLabel:'Verbs'},
  {k:'iadj', file:'adjectives-i.json', ja:'い形容詞', enLabel:'i-Adjectives'},
  {k:'naadj', file:'adjectives-na.json', ja:'な形容詞', enLabel:'na-Adjectives'},
  {k:'advs', file:'adverbs.json', ja:'副詞', enLabel:'Adverbs'},
  {k:'prt', file:'particles.json', ja:'助詞', enLabel:'Particles'},
  {k:'conj', file:'conjunctions.json', ja:'接続詞', enLabel:'Conjunctions'},
  {k:'interj',file:'interjections.json', ja:'感動詞', enLabel:'Interjections'},
  {k:'nums', file:'numerals.json', ja:'数詞', enLabel:'Numerals'},
  {k:'pat', file:'patterns.json', ja:'文型', enLabel:'Patterns'},
];

let level='N5', posKey='verbs', page=1, lastData=[];

// Storage, Fetch, Render functions ... (既存のロジックをここに維持)
// ※簡略化のため中身は以前のコードと同様として扱います

async function fetchJsonSafe(path){
  try{ const r=await fetch(path,{cache:'no-store'}); return r.ok ? await r.json() : []; }catch(_){ return []; }
}

function renderList(data){
  const list = document.getElementById('list');
  if(!list) return;
  list.innerHTML = data.length ? '' : '<div style="color:#6b7280; padding:12px 0;">No items found.</div>';
  data.slice(0, 5).forEach((item, i) => {
    const card = document.createElement('div'); card.className = 'card';
    card.innerHTML = `<div class="head"><span class="num">${i+1}.</span> <span class="tag">${item.ja}</span></div><div class="content">${item.en}</div>`;
    list.appendChild(card);
  });
}

async function onSearchInput(){
  const t = (document.getElementById('kw')?.value||'').trim().toLowerCase();
  if(!t) return;
  // 横断検索の簡易実装
  const tasks = [];
  LEVELS.forEach(lv => POS.forEach(p => {
    tasks.push(fetchJsonSafe(`data/json/${lv}/${p.file}`));
  }));
  const chunks = await Promise.all(tasks);
  const filtered = chunks.flat().filter(x => (x.ja||'').includes(t) || (x.en||'').includes(t));
  renderList(filtered.slice(0, 30));
}

function buildChips(){
  const chips=document.getElementById('posChips');
  if(!chips) return;
  chips.innerHTML='';
  POS.forEach(p=>{
    const b=document.createElement('button');
    b.className='chip'+(p.k===posKey?' active':'');
    b.textContent=p.enLabel;
    b.onclick=()=>{posKey=p.k; buildChips();};
    chips.appendChild(b);
  });
}

/* ====== 初期化 ====== */
(async function init(){
  buildChips();
  
  // 検索語の入力イベント
  const kwEl = document.getElementById('kw');
  if(kwEl){
    kwEl.addEventListener('input', onSearchInput, {passive:true});
  }

  // ★ ここが追加箇所：URLパラメータ (?kw=...) がある場合に自動検索を実行
  const params = new URLSearchParams(window.location.search);
  const query = params.get('kw');
  if (query) {
    if (kwEl) {
      kwEl.value = decodeURIComponent(query);
      // 検索処理を実行
      onSearchInput(); 
    }
  }

  // クイズボタンの遷移
  const quizBtn = document.getElementById('floatingQuizBtn');
  if (quizBtn){
    quizBtn.addEventListener('click', () => { window.location.href = '/quiz/index.html'; });
  }
})();
</script>
</body>
</html>
