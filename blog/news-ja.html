<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>お知らせ | nihongotext.com</title>
<meta name="description" content="nihongotext.com の公式お知らせ" />
<link rel="icon" href="/favicon.ico" />
<link rel="alternate" href="/blog/news.html" hreflang="en" />
<style>
  :root{--brand:#e53935;--ink:#222;--muted:#666;--bg:#fff;--line:#f0f0f0}
  *{box-sizing:border-box} html,body{margin:0;background:var(--bg);color:var(--ink);
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Noto Sans JP","Hiragino Kaku Gothic ProN","Yu Gothic",sans-serif}
  a{color:var(--brand);text-decoration:none} a:hover{text-decoration:underline}
  .site-header{position:sticky;top:0;z-index:10;background:#fff;border-bottom:1px solid var(--line)}
  .head-inner{max-width:900px;margin:0 auto;display:flex;gap:12px;align-items:center;padding:12px 16px}
  .brand{font-weight:800;font-size:20px}.brand .dot{color:var(--brand)}
  nav{margin-left:auto;display:flex;gap:14px} nav a{color:var(--ink);font-weight:600}
  nav a.active{color:var(--brand)}
  .lang{margin-left:8px;display:flex;gap:8px}
  .lang a,.lang span{font-weight:700;font-size:13px;border:1px solid var(--line);padding:6px 10px;border-radius:999px}
  .lang span{background:var(--brand);color:#fff;border-color:var(--brand)}
  .wrap{max-width:900px;margin:0 auto;padding:20px 16px 60px}
  .breadcrumbs{font-size:14px;color:var(--muted);margin:6px 0 14px}
  .page-title{font-size:28px;font-weight:800;margin:18px 0 10px}
  .desc{color:var(--muted);margin:0 0 18px}
  .search{display:flex;gap:8px;margin:12px 0 18px}
  .search input{flex:1;padding:10px 12px;border:1px solid var(--line);border-radius:10px}
  .count{font-size:13px;color:var(--muted);margin-bottom:10px}
  .item{border-top:1px solid var(--line);padding:18px 0}
  .meta{display:flex;gap:10px;align-items:center;color:var(--muted);font-size:13px}
  .badge{background:var(--brand);color:#fff;font-size:12px;font-weight:700;border-radius:999px;padding:2px 8px}
  .title{font-size:20px;font-weight:800;margin:6px 0}
  .body{color:#333;line-height:1.95}
  .links{margin-top:6px}
  .links a{margin-right:10px}
  .site-footer{border-top:1px solid var(--line);padding:22px 16px;color:var(--muted)}
  .foot-inner{max-width:900px;margin:0 auto;display:flex;justify-content:space-between;gap:12px;flex-wrap:wrap}
</style>
<script type="application/ld+json" id="ld-json"></script>
</head>
<body>
<header class="site-header">
  <div class="head-inner">
    <a class="brand" href="/index.html"><span>nihongotext<span class="dot">.com</span></span></a>
    <nav>
      <a href="/index.html">ホーム</a>
      <a href="/blog/index.html">ブログ</a>
      <a href="/blog/news-ja.html" class="active">お知らせ</a>
      <a href="/inquiry/index.html">お問い合わせ</a>
    </nav>
    <div class="lang"><span>日本語</span><a href="/blog/news.html">English</a></div>
  </div>
</header>

<main class="wrap">
  <div class="breadcrumbs"><a href="/index.html">ホーム</a> / <a href="/blog/index.html">ブログ</a> / お知らせ</div>
  <h1 class="page-title">お知らせ</h1>
  <p class="desc">nihongotext.com の公式アップデート情報をお届けします。</p>

  <div class="search" role="search">
    <input id="q" type="search" placeholder="お知らせを検索（タイトル・要約・本文）" aria-label="検索"/>
  </div>
  <div class="count" id="count"></div>

  <section id="list" aria-live="polite"></section>
</main>

<footer class="site-footer">
  <div class="foot-inner"><div>© 2025 nihongotext.com</div>
    <div><a href="/blog/index.html">ブログ</a> / <a href="/inquiry/index.html">お問い合わせ</a></div></div>
</footer>

<script>
  const list = document.getElementById('list');
  const q = document.getElementById('q');
  const count = document.getElementById('count');
  let DATA = [];

  fetch('/blog/news.json', {cache:'no-store'})
    .then(r=>r.json())
    .then(json=>{
      DATA = json.sort((a,b)=> a.date < b.date ? 1 : -1);
      render(DATA);
      injectLDJson(DATA, 'ja');
    })
    .catch(()=>{ list.innerHTML = '<p class="body">読み込みに失敗しました。</p>'; });

  function render(items){
    count.textContent = `${items.length}件`;
    list.innerHTML = items.map(item=>{
      const ja = item.ja || {};
      const links = (ja.links||[]).map(l=>`<a href="${l.href}">${esc(l.label)}</a>`).join('');
      return `
        <article class="item" data-id="${esc(item.id)}">
          <div class="meta"><span class="badge">${esc(item.type||'お知らせ')}</span>
            <time datetime="${esc(item.date)}">${fmtJP(item.date)}</time></div>
          <h2 class="title">${ruby(ja.title || '(日本語版の準備中です)')}</h2>
          ${ja.summary?`<p class="body">${ruby(ja.summary)}</p>`:''}
          ${(ja.body||[]).map(p=>`<p class="body">${ruby(p)}</p>`).join('')}
          ${links?`<p class="links">${links}</p>`:''}
        </article>
      `;
    }).join('');
  }

  // --- 検索（日本語項目を対象）
  q.addEventListener('input', ()=>{
    const v = q.value.trim().toLowerCase();
    const filtered = !v ? DATA : DATA.filter(item=>{
      const ja = item.ja || {};
      const hay = [
        item.type, item.date, ja.title, ja.summary, ...(ja.body||[])
      ].filter(Boolean).join(' ').toLowerCase();
      return hay.includes(v);
    });
    render(filtered);
  });

  // 「漢字(かな)」→ <ruby>漢字<rt>かな</rt></ruby>
  function ruby(s){
    return esc(String(s)).replace(/([^\s()（）]+)\(([^()]+)\)/g,
      (_m,kan,rt)=>`<ruby>${kan}<rt>${rt}</rt></ruby>`);
  }
  function fmtJP(iso){
    const d = new Date(iso+'T00:00:00'); const y=d.getFullYear(), m=d.getMonth()+1, day=d.getDate();
    return `${y}年${String(m).padStart(2,'0')}月${String(day).padStart(2,'0')}日`;
  }
  function esc(s){return String(s).replaceAll('&','&amp;').replaceAll('<','&lt;')
    .replaceAll('>','&gt;').replaceAll('"','&quot;').replaceAll("'","&#39;')}
  function injectLDJson(items, lang){
    const data = {
      "@context":"https://schema.org",
      "@type":"ItemList",
      "itemListElement": items.map((n,idx)=>({
        "@type":"ListItem","position":idx+1,
        "item":{"@type":"BlogPosting","inLanguage":lang,"headline":n.ja?.title||n.en?.title||'',
          "datePublished":n.date,"dateModified":n.date,"articleSection":n.type,
          "description":n.ja?.summary||''}}))
    };
    document.getElementById('ld-json').textContent = JSON.stringify(data);
  }
</script>
</body>
</html>