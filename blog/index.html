<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>お知らせ・ブログ | nihongotext.com</title>
<meta name="color-scheme" content="light only" />

<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet" crossorigin="anonymous" referrerpolicy="no-referrer" />

<!-- GA4（トップと同じID） -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-9QSHWJE0HZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-9QSHWJE0HZ', { send_page_view:false });
</script>

<!-- AdSense（トップと同じクライアント） -->
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2358198194205084" crossorigin="anonymous"></script>

<style>
:root{
  --shu:#e6462d; --shu-deep:#c13727; --shu-tint:#fff2ef;
  --white:#fff; --ink:#1f2937; --muted:#6b7280; --border:#efdfdc;
}
*{box-sizing:border-box}
html,body{margin:0;color:var(--ink);background:var(--white);
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Noto Sans JP","Yu Gothic",Meiryo,sans-serif}
a{color:inherit;text-decoration:none}
.container{max-width:1100px;margin:0 auto;padding:0 16px}

/* ====== Header（トップと同様：ロゴクリックでトップへ） ====== */
header{border-bottom:3px solid var(--shu);background:#fff}
.h-row{display:flex;align-items:center;justify-content:space-between;padding:10px 0}
.brand{display:flex;flex-direction:column;gap:2px}
.brand a.brand-link{display:inline-block;color:inherit;text-decoration:none}
.brand a.brand-link:focus-visible{outline:3px solid rgba(230,70,45,.35);border-radius:6px}
.brand-title{font-weight:980;letter-spacing:.3px;font-size:clamp(24px,4.2vw,32px);color:var(--shu)}
.brand-sub{width:fit-content;margin:0 auto;color:#ffb9aa;font-weight:700;font-size:12px;letter-spacing:.4px}
.iconbar{display:flex;gap:10px;flex-wrap:wrap;justify-content:center}
.iconbar .tool{display:inline-flex;width:38px;height:38px;align-items:center;justify-content:center;border-radius:50%;
  border:1px solid var(--border);background:#fff}
.iconbar .tool i{color:var(--shu)}
.iconbar .tool:hover{border-color:var(--shu)}
/* Alphabet ボタン（右上） */
header .container.positioned{position:relative}
#btnAlphabet{position:absolute;right:16px;top:12px;border:1px solid var(--border);background:#fff;border-radius:999px;padding:6px 10px;cursor:pointer}
#btnAlphabet.active{border-color:var(--shu);background:#fff;color:var(--shu-deep)}

/* ====== Blog main ====== */
main.blog{max-width:860px;margin:20px auto;padding:0 16px}
.title-row{display:flex;align-items:center;gap:10px;justify-content:space-between;margin:6px 0 14px}
.title-row h1{margin:0}
.homebtn{display:inline-flex;align-items:center;justify-content:center;gap:8px;
  border:1px solid var(--border);background:#fff;border-radius:10px;padding:8px 12px;}
.homebtn i{color:var(--shu)}
.homebtn:hover{border-color:var(--shu)}
.post{border:1px solid var(--border);border-radius:12px;padding:16px;margin-bottom:14px;background:var(--shu-tint);box-shadow:0 2px 8px rgba(230,70,45,.05)}
.post h2{margin:0 0 6px;color:var(--shu)}
.post .date{color:var(--muted);font-size:13px;margin-bottom:8px}
.post p{line-height:1.6}
.post .tags{margin-top:8px;color:var(--muted);font-size:13px}

/* ====== Footer（トップと同様） ====== */
footer{border-top:3px solid var(--shu);margin-top:24px;background:#fff}
.f-row{display:flex;flex-direction:column;gap:8px;align-items:center;justify-content:center;padding:12px 0}
.copy{color:#6b7280}

/* Ad area */
#adWrap{margin:16px 0;text-align:center}

/* ====== Contact Modal mount（共通部品を挿入する受け皿） ====== */
#contact-modal-mount{position:relative;z-index:60}
</style>
</head>
<body>
<header>
  <!-- 1行目：ロゴ（クリックでトップへ） + beta + Alphabet -->
  <div class="container h-row positioned">
    <div class="brand">
      <a class="brand-link" href="/" aria-label="nihongotext.com のトップページへ">
        <div class="brand-title">nihongotext<span style="color:var(--shu-deep)">.com</span></div>
        <div class="brand-sub">== beta version ==</div>
      </a>
    </div>
    <button id="btnAlphabet" title="Alphabet mode">Alphabet</button>
  </div>

  <!-- 2行目：アイコン（トップと同様の並び） -->
  <div class="container">
    <nav class="iconbar" aria-label="site icons">
      <a class="tool" id="icPrint"  title="印刷（本文）" href="javascript:void(0)"><i class="fas fa-print"></i></a>
      <a class="tool" id="openContact" title="お問い合わせ（チャット）" href="javascript:void(0)"><i class="fas fa-comments"></i></a>
      <!-- 覚えた一覧はトップで提供：案内としてトップへ遷移 -->
      <a class="tool" id="icLearnedHeader" title="覚えた一覧（トップで開きます）" href="/"><i class="fas fa-list-check"></i></a>
      <a class="tool" title="お知らせ（ブログ）" href="/blog/"><i class="fas fa-bell"></i></a>
      <a class="tool" title="Reddit" target="_blank" href="https://reddit.com/r/nihongotext"><i class="fab fa-reddit"></i></a>
      <a class="tool" title="Medium" target="_blank" href="https://medium.com/@nihongotext"><i class="fab fa-medium"></i></a>
      <a class="tool" title="Substack" target="_blank" href="https://substack.com/@nihongotext"><i class="fas fa-envelope-open-text"></i></a>
    </nav>
  </div>
</header>

<main class="blog" id="main">
  <!-- タイトル行（右端にホームボタン） -->
  <div class="title-row">
    <h1 id="ttl">お知らせ・ブログ</h1>
    <a class="homebtn" href="/" title="トップへ（Home）" aria-label="トップへ">
      <span class="only-label" style="font-size:14px">Home</span>
      <i class="fas fa-house" aria-hidden="true"></i>
    </a>
  </div>

  <!-- 記事リスト -->
  <div id="posts"></div>

  <!-- インフィード広告（任意） -->
  <div id="adWrap">
    <ins class="adsbygoogle"
      style="display:block; text-align:center;"
      data-ad-layout="in-article"
      data-ad-format="fluid"
      data-ad-client="ca-pub-2358198194205084"
      data-ad-slot="3714541070"></ins>
  </div>
</main>

<footer>
  <div class="container f-row">
    <nav class="iconbar" aria-label="site icons">
      <a class="tool" id="icPrintFooter"  title="印刷（本文）" href="javascript:void(0)"><i class="fas fa-print"></i></a>
      <a class="tool" id="openContactF" title="お問い合わせ（チャット）" href="javascript:void(0)"><i class="fas fa-comments"></i></a>
      <a class="tool" id="icLearnedF" title="覚えた一覧（トップで開きます）" href="/"><i class="fas fa-list-check"></i></a>
      <a class="tool" title="お知らせ（ブログ）" href="/blog/"><i class="fas fa-bell"></i></a>
      <a class="tool" title="Reddit" target="_blank" href="https://reddit.com/r/nihongotext"><i class="fab fa-reddit"></i></a>
      <a class="tool" title="Medium" target="_blank" href="https://medium.com/@nihongotext"><i class="fab fa-medium"></i></a>
      <a class="tool" title="Substack" target="_blank" href="https://substack.com/@nihongotext"><i class="fas fa-envelope-open-text"></i></a>
    </nav>
    <div class="copy">© 2025 nihongotext.com</div>
  </div>
</footer>

<!-- ===== Contact Modal（共通HTMLを差し込むマウント） ===== -->
<div id="contact-modal-mount"></div>

<!-- ===== Blog scripts ===== -->
<script>
(() => {
  // 言語状態（ブログ本文の i18n）
  const LANG_KEY = 'nt_blog_lang';
  let lang = localStorage.getItem(LANG_KEY) || 'ja';
  const t = (ja,en) => (lang === 'ja' ? ja : en);

  const els = {
    posts:  document.getElementById('posts'),
    ttl:    document.getElementById('ttl'),
    homeLbl:document.querySelector('.homebtn .only-label')
  };

  function applyI18N(){
    els.ttl.textContent = t('お知らせ・ブログ','News & Blog');
    document.title = t('お知らせ・ブログ | nihongotext.com','News & Blog | nihongotext.com');
    if(els.homeLbl) els.homeLbl.textContent = t('ホーム','Home');
  }

  async function loadAndRender(){
    try{
      const res  = await fetch('./posts.json?ts=' + Date.now(), {cache:'no-store'});
      const data = await res.json();
      data.sort((a,b)=> new Date(b.date) - new Date(a.date));
      els.posts.innerHTML = '';
      data.forEach(p => {
        const title = lang==='ja' ? (p.title_ja || p.title_en || p.slug)
                                  : (p.title_en || p.title_ja || p.slug);
        const summary = lang==='ja' ? (p.summary_ja || '') : (p.summary_en || '');
        const url = `./posts/${p.slug}.html`;
        const div = document.createElement('article');
        div.className = 'post';
        div.innerHTML = `
          <h2><a href="${url}">${title}</a></h2>
          <div class="date">${p.date}</div>
          <p>${summary}</p>
          ${(p.tags && p.tags.length) ? `<div class="tags">${t('タグ: ','Tags: ')}${p.tags.join(', ')}</div>` : '' }
        `;
        els.posts.appendChild(div);
      });
      try { (window.adsbygoogle = window.adsbygoogle || []).push({}); } catch(_){}
      if (typeof gtag === 'function'){
        gtag('event','page_view', { page_title: document.title, page_location: location.href, page_path: '/blog/' });
      }
    }catch(e){
      els.posts.innerHTML = '<div style="color:#6b7280">記事の読み込みに失敗しました。</div>';
    }
  }

  // Alphabet ボタンは外観のみ（本文には影響なし）
  const $btnAlpha = document.getElementById('btnAlphabet');
  $btnAlpha?.addEventListener('click', ()=> $btnAlpha.classList.toggle('active'));

  // 印刷（本文領域）
  function printElement(el){
    const w=window.open('', '_blank');
    const html=`<html><head><meta charset="utf-8"><title>Print</title>
    <style>
      body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Noto Sans JP","Yu Gothic",Meiryo,sans-serif;padding:20px}
      article.post{border:1px solid #ddd;border-radius:12px;padding:14px;margin-bottom:12px}
      h1,h2{margin:0 0 8px}
    </style></head><body>${el.innerHTML}</body></html>`;
    w.document.open(); w.document.write(html); w.document.close(); w.focus(); w.print(); w.close();
  }
  document.getElementById('icPrint')?.addEventListener('click', ()=>printElement(document.getElementById('main')));
  document.getElementById('icPrintFooter')?.addEventListener('click', ()=>printElement(document.getElementById('main')));

  applyI18N();
  loadAndRender();
})();
</script>

<!-- ===== 共通：チャットモーダルを外部から読み込み＆初期化 ===== -->
<script>
(async () => {
  const mount = document.getElementById('contact-modal-mount');

  // 1) HTMLを読み込み（存在しない場合は graceful fallback）
  let html = '';
  try {
    const res = await fetch('/common/contact-modal.html', {cache:'no-store'});
    if(!res.ok) throw new Error('contact html not found');
    html = await res.text();
  } catch (e) {
    console.warn('[contact] modal html load failed:', e);
    html = '<!-- contact modal not available -->';
  }
  mount.innerHTML = html;

  // 2) 初期化スクリプトを読み込み
  async function loadScript(src){
    return new Promise((resolve,reject)=>{
      const s=document.createElement('script');
      s.src=src; s.defer=true;
      s.onload=resolve; s.onerror=reject;
      document.head.appendChild(s);
    });
  }
  let jsReady = false;
  try{
    await loadScript('/assets/contact.js');
    jsReady = typeof window.initContactModal === 'function';
  }catch(e){
    console.warn('[contact] js load failed:', e);
  }

  // 3) 初期化（存在チェック付き）
  if(jsReady){
    window.initContactModal({
      endpoint: 'https://script.google.com/macros/s/AKfycbz2wQN431cFfswmnqadJlTgstgeJCOYooh8O1SX5ic6Bf9oOoHWKHOPGN17QpOozXcJ-g/exec',
      sitekey:  '6LeLRe4rAAAAAG9bnqf-BeU8rI3EM8k8F5plub25',
      defaultLang: 'ja'
    });
  }else{
    // Fallback：ボタン押下時はアラートで案内（共通ファイル未設置時）
    const fallback = () => alert('お問い合わせ（チャット）は準備中です。トップページからご利用ください。');
    document.getElementById('openContact')?.addEventListener('click', fallback);
    document.getElementById('openContactF')?.addEventListener('click', fallback);
  }
})();
</script>
<!-- ▼ お問い合わせモーダル（共通）を読み込む：/common, /assets はサイトルート -->
<div id="contact-modal-mount"></div>
<script>
(async () => {
  // 1) モーダルHTMLを読み込んで設置
  const mount = document.getElementById('contact-modal-mount');
  try {
    const res = await fetch('/common/contact-modal.html', { cache: 'no-store' });
    if (!res.ok) throw new Error('modal html ' + res.status);
    mount.innerHTML = await res.text();
  } catch (e) {
    console.warn('contact modal html load failed:', e);
    // フォールバック（現状の「準備中」alert）
    const fallback = (e) => { alert('お問い合わせ（チャット）は準備中です。トップページからご利用ください。'); };
    document.getElementById('openContact')?.addEventListener('click', fallback);
    document.getElementById('openContactF')?.addEventListener('click', fallback);
    return; // ここで終了
  }

  // 2) contact.js をロード（/assets はサイトルート）
  await new Promise((resolve, reject) => {
    const s = document.createElement('script');
    s.src = '/assets/contact.js'; s.async = true;
    s.onload = resolve; s.onerror = reject;
    document.head.appendChild(s);
  });

  // 3) 初期化（トップページと同じ設定値）
  //    ※ 既存 index.html から拾った値をそのまま利用
  const CC_ENDPOINT = 'https://script.google.com/macros/s/AKfycbz2wQN431cFfswmnqadJlTgstgeJCOYooh8O1SX5ic6Bf9oOoHWKHOPGN17QpOozXcJ-g/exec';
  const RECAPTCHA_SITEKEY = '6LeLRe4rAAAAAG9bnqf-BeU8rI3EM8k8F5plub25';

  if (window.initContactModal) {
    window.initContactModal({
      endpoint: CC_ENDPOINT,
      sitekey: RECAPTCHA_SITEKEY,
      defaultLang: (document.documentElement.lang || 'ja')
    });
  } else {
    console.error('initContactModal is not defined.');
  }
})();
</script>
<!-- ▲ ここまでを </body> の直前に追加 -->
</body>
</html>
