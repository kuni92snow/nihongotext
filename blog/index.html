<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>News & Blog | nihongotext.com</title>
  <style>
    body{font-family:system-ui,-apple-system,"Segoe UI",Roboto,Arial, "Noto Sans JP",sans-serif;background:#fafafa;margin:0;padding:24px;color:#222;}
    .wrap{max-width:1100px;margin:0 auto;}
    h1{font-size:28px;margin:0 0 20px;}
    .toolbar{display:flex;gap:8px;margin-bottom:16px}
    .btn{padding:6px 12px;border-radius:16px;border:1px solid #ddd;background:#fff;cursor:pointer}
    .btn.is-active{background:#111;color:#fff;border-color:#111}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:20px}
    .card{background:#fff;border:1px solid #eee;border-radius:12px;padding:18px}
    .label{font-size:12px;color:#666;margin:6px 0 4px}
    input,textarea{width:100%;box-sizing:border-box;border:1px solid #ddd;border-radius:10px;padding:10px;font-size:14px;background:#fff}
    textarea{min-height:150px;resize:vertical}
    .row{display:flex;gap:10px;align-items:center;margin-top:12px}
    .row.right{justify-content:flex-end}
    .msg{font-size:13px;margin-top:8px}
    .msg.ok{color:#0a7d36}
    .msg.ng{color:#b00020}
    .qa{display:flex;flex-direction:column;gap:12px}
    .qaItem{background:#f7faf7;border:1px solid #e3f2e3;border-radius:10px;padding:12px}
    .qaTitle{font-weight:600;margin:0 0 6px}
    .qaQ{margin:0 0 6px}
    .qaA{margin:0;color:#226c2a}
    .muted{color:#888}
    @media (max-width: 900px){.grid{grid-template-columns:1fr}}
  </style>
</head>
<body>
<div class="wrap">
  <h1>News & Blog</h1>

  <!-- language toggle -->
  <div class="toolbar">
    <button id="btn-ja" class="btn">日本語</button>
    <button id="btn-en" class="btn">English</button>
  </div>

  <div class="grid">
    <!-- Contact -->
    <div class="card">
      <h2 id="h-contact" style="margin-top:0">お問い合わせ</h2>

      <div class="label" id="l-name">お名前 / Name</div>
      <input id="f-name" autocomplete="name" />

      <div class="label" id="l-email">メール / Email</div>
      <input id="f-email" autocomplete="email" />

      <div class="label" id="l-subj">件名 / Subject</div>
      <input id="f-subj" />

      <div class="label" id="l-msg">メッセージ / Message</div>
      <textarea id="f-msg" placeholder=""></textarea>

      <div class="row" style="align-items:flex-start">
        <div class="g-recaptcha" data-sitekey="6LcRKvArAAAAAFVmY21y9o_hwTszHwzp3bgRXtBV"></div>
      </div>

      <div class="row">
        <button id="btn-cancel" class="btn" type="button">キャンセル</button>
        <button id="btn-send" class="btn" type="button">送信</button>
      </div>

      <div id="note" class="msg muted">
        reCAPTCHA と Google の <a href="https://policies.google.com/privacy" target="_blank" rel="noopener">プライバシーポリシー</a> と
        <a href="https://policies.google.com/terms" target="_blank" rel="noopener">利用規約</a> が適用されます。
      </div>
      <div id="status" class="msg"></div>
    </div>

    <!-- Q&A -->
    <div class="card">
      <h2 style="margin-top:0">Q&amp;A</h2>
      <div id="qaStatus" class="muted">読み込み中… / Loading…</div>
      <div id="qaList" class="qa" aria-live="polite"></div>

      <!-- 初期表示（API到着までのプレースホルダー） -->
      <template id="seed">
        <div class="qaItem">
          <div class="qaTitle">問い合わせについて</div>
          <p class="qaQ">Q. かならず返答していただけますか？</p>
          <p class="qaA">A. できる限り返信はします。ただし、「確認しました。」のみの返信となる場合もあります。ご了承下さい。</p>
        </div>
        <div class="qaItem">
          <div class="qaTitle">音声について</div>
          <p class="qaQ">Q. 音声の実装予定はありますか？</p>
          <p class="qaA">A. あります。ただし、公開時期は未定です。</p>
        </div>
      </template>
    </div>
  </div>
</div>

<!-- === Scripts === -->
<script>
// ======= Config (YOUR exec URL here) =======
const EXEC_JSONP_BASE = "https://script.google.com/macros/s/AKfycbx4xEjA43o2oovNbuvAvZQgqw2HfYt-ZVnrHr8WOT0bI2hJ8SpfXSYKYCRS97z_IcNF/exec";

// ======= i18n =======
const t = {
  ja: {
    contact: "お問い合わせ",
    name:"お名前 / Name",
    email:"メール / Email",
    subj:"件名 / Subject",
    msg:"メッセージ / Message",
    cancel:"キャンセル", send:"送信",
    sentOk:"送信しました。ありがとうございました。",
    sentNg:"送信に失敗しました。時間をおいて再度お試しください。",
    qaLoading:"読み込み中…",
    qaFailed:"読み込みに失敗しました。"
  },
  en: {
    contact:"Contact",
    name:"Name",
    email:"Email",
    subj:"Subject",
    msg:"Message",
    cancel:"Cancel", send:"Send",
    sentOk:"Your message was sent. Thank you!",
    sentNg:"Failed to send. Please try again later.",
    qaLoading:"Loading…",
    qaFailed:"Failed to load."
  }
};
const lang = (new URL(location.href).searchParams.get("lang") || "ja").toLowerCase() === "en" ? "en" : "ja";
document.getElementById("btn-ja").classList.toggle("is-active", lang==="ja");
document.getElementById("btn-en").classList.toggle("is-active", lang==="en");
document.getElementById("btn-ja").onclick = ()=> switchLang("ja");
document.getElementById("btn-en").onclick = ()=> switchLang("en");
function switchLang(l){ const u=new URL(location.href); u.searchParams.set("lang", l); location.href=u.toString(); }

function applyTexts(){
  const L = t[lang];
  document.getElementById("h-contact").textContent = L.contact;
  document.getElementById("l-name").textContent = L.name;
  document.getElementById("l-email").textContent = L.email;
  document.getElementById("l-subj").textContent = L.subj;
  document.getElementById("l-msg").textContent = L.msg;
  document.getElementById("btn-cancel").textContent = L.cancel;
  document.getElementById("btn-send").textContent = L.send;
  document.getElementById("qaStatus").textContent = L.qaLoading;
}
applyTexts();

// ======= JSONP helper =======
function jsonp(url){
  return new Promise((resolve,reject)=>{
    const cb = `cb_${Date.now()}_${Math.floor(Math.random()*1e6)}`;
    const s = document.createElement("script");
    const u = new URL(url);
    u.searchParams.set("callback", cb);
    window[cb] = (data)=>{ resolve(data); cleanup(); };
    s.onerror = ()=>{ reject(new Error("jsonp failed")); cleanup(); };
    s.src = u.toString();
    document.body.appendChild(s);
    function cleanup(){ delete window[cb]; s.remove(); }
  });
}
function enc(v){ return encodeURIComponent(v || ""); }

// ======= Q&A load =======
function renderSeed(){
  const tpl = document.getElementById("seed");
  if(!tpl) return;
  const qa = document.getElementById("qaList");
  qa.innerHTML = "";
  qa.appendChild(tpl.content.cloneNode(true));
}
renderSeed();

async function loadQA(){
  try{
    const url = `${EXEC_JSONP_BASE}?mode=qa`;
    const res = await jsonp(url);
    if(!res || !res.ok){ throw new Error("bad"); }
    const items = Array.isArray(res.items) ? res.items : [];
    const qa = document.getElementById("qaList");
    qa.innerHTML = "";
    if(items.length === 0){
      document.getElementById("qaStatus").textContent = "";
      return;
    }
    for(const it of items){
      const div = document.createElement("div");
      div.className = "qaItem";
      div.innerHTML = `
        <div class="qaTitle"></div>
        <p class="qaQ"></p>
        <p class="qaA"></p>
      `;
      div.querySelector(".qaTitle").textContent = it.title || "";
      div.querySelector(".qaQ").textContent    = (lang==="ja"?"Q. ":"Q. ") + (it.question || "");
      div.querySelector(".qaA").textContent    = (lang==="ja"?"A. ":"A. ") + (it.answer || "");
      document.getElementById("qaList").appendChild(div);
    }
    document.getElementById("qaStatus").textContent = "";
  }catch(e){
    document.getElementById("qaStatus").textContent = t[lang].qaFailed;
  }
}
loadQA();

// ======= contact submit =======
document.getElementById("btn-cancel").onclick = ()=> {
  document.getElementById("f-name").value = "";
  document.getElementById("f-email").value = "";
  document.getElementById("f-subj").value = "";
  document.getElementById("f-msg").value = "";
  document.getElementById("status").textContent = "";
  if(window.grecaptcha){ grecaptcha.reset(); }
};

document.getElementById("btn-send").onclick = async ()=>{
  const name = document.getElementById("f-name").value.trim();
  const email = document.getElementById("f-email").value.trim();
  const subj = document.getElementById("f-subj").value.trim();
  const msg  = document.getElementById("f-msg").value.trim();

  // reCAPTCHA token
  let token = "";
  try{
    token = grecaptcha.getResponse();
  }catch(_){}
  if(!token){
    document.getElementById("status").className = "msg ng";
    document.getElementById("status").textContent = "Please complete reCAPTCHA.";
    return;
  }

  const url = `${EXEC_JSONP_BASE}?mode=contact_submit`
    + `&name=${enc(name)}&email=${enc(email)}&subject=${enc(subj)}&message=${enc(msg)}&token=${enc(token)}`;

  try{
    const res = await jsonp(url);
    if(res && res.ok){
      document.getElementById("status").className = "msg ok";
      document.getElementById("status").textContent = t[lang].sentOk;
      document.getElementById("btn-cancel").click();
    }else{
      throw new Error("send failed");
    }
  }catch(err){
    document.getElementById("status").className = "msg ng";
    document.getElementById("status").textContent = t[lang].sentNg;
  }finally{
    if(window.grecaptcha){ grecaptcha.reset(); }
  }
};
</script>

<!-- reCAPTCHA v2 -->
<script src="https://www.google.com/recaptcha/api.js" async defer></script>
</body>
</html>
