<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>News & Blog | nihongotext.com</title>
  <style>
    :root{
      --bg:#fafafa; --card:#fff; --text:#222; --muted:#777; --brand:#e34b4b;
      --bd:#e6e6e6; --ok:#108a00; --err:#b00020;
    }
    html,body{margin:0;padding:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Hiragino Kaku Gothic ProN","Noto Sans JP","Yu Gothic",Meiryo,sans-serif;}
    .wrap{max-width:980px;margin:0 auto;padding:28px 16px;}
    header h1{font-size:28px;margin:0 0 20px}
    .lang-switch{display:flex;gap:.5rem}
    .lang-btn{border:1px solid var(--bd);background:#fff;border-radius:24px;padding:6px 12px;cursor:pointer}
    .lang-btn.active{border-color:var(--brand);color:#fff;background:var(--brand)}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:18px}
    @media (max-width:920px){.grid{grid-template-columns:1fr}}
    .card{background:var(--card);border:1px solid var(--bd);border-radius:10px;padding:18px}
    .card h2{margin:0 0 14px}
    label{display:block;font-size:12px;color:var(--muted);margin:10px 0 6px}
    input[type="text"],input[type="email"],textarea{
      width:100%;box-sizing:border-box;border:1px solid var(--bd);border-radius:8px;padding:10px 12px;font-size:15px;background:#fff
    }
    textarea{min-height:120px;resize:vertical}
    .row{display:flex;gap:8px;align-items:center;margin-top:12px}
    .btn{appearance:none;border:1px solid var(--bd);background:#fff;border-radius:8px;padding:10px 16px;font-weight:600;cursor:pointer}
    .btn.primary{background:var(--brand);border-color:var(--brand);color:#fff}
    .fine{font-size:12px;color:var(--muted);margin-top:8px}
    .status{margin-top:10px;font-size:14px}
    .status.ok{color:var(--ok)} .status.err{color:var(--err)}
    .qa-empty{color:var(--muted)}
    .qa-item{border-top:1px dashed var(--bd);padding:14px 0}
    .qa-item:first-child{border-top:0}
    .qa-title{margin:.2rem 0 .3rem;font-size:16px}
    .qa-meta{color:var(--muted);font-size:12px;margin-bottom:.35rem}
    .qa-q strong,.qa-a strong{color:var(--brand)}
  </style>
</head>
<body>
  <div class="wrap">
    <header style="display:flex;justify-content:space-between;align-items:center;">
      <h1 id="t_head">News & Blog</h1>
      <div class="lang-switch">
        <button class="lang-btn" data-lang="ja" id="btn-ja">日本語</button>
        <button class="lang-btn" data-lang="en" id="btn-en">English</button>
      </div>
    </header>

    <div class="grid">
      <!-- Contact -->
      <section class="card">
        <h2 id="t_contact">お問い合わせ</h2>
        <form id="contact-form" method="POST"
              action="https://script.google.com/macros/s/AKfycbx4xEjA43o2oovNbuvAvZQgqw2HfYt-ZVnrHr8WOT0bI2hJ8SpfXSYKYCRS97z_IcNF/exec"
              target="contact_iframe">
          <label id="t_name_label">お名前 / Name</label>
          <input type="text" name="name" required autocomplete="name">

          <label id="t_email_label">メール / Email</label>
          <input type="email" name="email" required autocomplete="email">

          <label id="t_subject_label">件名 / Subject</label>
          <input type="text" name="subject" required>

          <label id="t_msg_label">メッセージ / Message</label>
          <textarea name="message" required></textarea>

          <input type="hidden" name="token" id="recaptcha-token">

          <div class="row">
            <button type="button" class="btn" id="btn-cancel">キャンセル</button>
            <button type="submit" class="btn primary" id="btn-send">送信</button>
          </div>

          <div class="fine" id="t_policy">
            reCAPTCHA と Google の <a href="https://policies.google.com/privacy" target="_blank" rel="noopener">プライバシーポリシー</a> と
            <a href="https://policies.google.com/terms" target="_blank" rel="noopener">利用規約</a> が適用されます。
          </div>
          <div id="status" class="status" aria-live="polite"></div>
        </form>
        <iframe name="contact_iframe" style="display:none"></iframe>
      </section>

      <!-- Q&A -->
      <section class="card">
        <h2>Q&A</h2>
        <div id="qa-list" class="qa-empty">Loading…</div>
      </section>
    </div>
  </div>

  <!-- reCAPTCHA -->
  <script src="https://www.google.com/recaptcha/api.js?render=6LcRKvArAAAAAFVmY21y9o_hwTszHwzp3bgRXtBV"></script>

  <script>
    // ====== CONFIG ======
    const EXEC_URL = "https://script.google.com/macros/s/AKfycbx4xEjA43o2oovNbuvAvZQgqw2HfYt-ZVnrHr8WOT0bI2hJ8SpfXSYKYCRS97z_IcNF/exec";
    const SITE_KEY = "6LcRKvArAAAAAFVmY21y9o_hwTszHwzp3bgRXtBV";

    // ====== i18n ======
    const dict = {
      ja: {
        head: "News & Blog",
        contact: "お問い合わせ",
        name: "お名前 / Name",
        email: "メール / Email",
        subject: "件名 / Subject",
        message: "メッセージ / Message",
        cancel: "キャンセル",
        send: "送信",
        policy: 'reCAPTCHA と Google の <a href="https://policies.google.com/privacy" target="_blank" rel="noopener">プライバシーポリシー</a> と <a href="https://policies.google.com/terms" target="_blank" rel="noopener">利用規約</a> が適用されます。',
        sent: "ありがとうございます。送信しました。",
        fail: "送信に失敗しました。しばらくしてからお試しください。"
      },
      en: {
        head: "News & Blog",
        contact: "Contact",
        name: "Name",
        email: "Email",
        subject: "Subject",
        message: "Message",
        cancel: "Cancel",
        send: "Send",
        policy: 'This site is protected by reCAPTCHA and the Google <a href="https://policies.google.com/privacy" target="_blank" rel="noopener">Privacy Policy</a> and <a href="https://policies.google.com/terms" target="_blank" rel="noopener">Terms of Service</a> apply.',
        sent: "Thanks! Your message has been sent.",
        fail: "Failed to send. Please try again later."
      }
    };
    function getLang(){
      const m = location.search.match(/[?&]lang=(ja|en)\b/);
      return (m && m[1]) || "ja";
    }
    function setLang(lang){
      document.documentElement.lang = lang;
      document.getElementById("btn-ja").classList.toggle("active", lang==="ja");
      document.getElementById("btn-en").classList.toggle("active", lang==="en");
      const t = dict[lang];
      document.getElementById("t_head").textContent = t.head;
      document.getElementById("t_contact").textContent = t.contact;
      document.getElementById("t_name_label").textContent = t.name;
      document.getElementById("t_email_label").textContent = t.email;
      document.getElementById("t_subject_label").textContent = t.subject;
      document.getElementById("t_msg_label").textContent = t.message;
      document.getElementById("btn-cancel").textContent = t.cancel; // ← 修正ポイント
      document.getElementById("btn-send").textContent = t.send;
      document.getElementById("t_policy").innerHTML = t.policy;
    }
    document.getElementById("btn-ja").onclick = ()=>{ location.search = "?lang=ja"; };
    document.getElementById("btn-en").onclick = ()=>{ location.search = "?lang=en"; };
    setLang(getLang());

    // ====== Contact: reCAPTCHA -> submit (hidden iframe) ======
    const form = document.getElementById("contact-form");
    const statusEl = document.getElementById("status");
    document.getElementById("btn-cancel").addEventListener("click", ()=>{ form.reset(); statusEl.textContent=""; });

    form.addEventListener("submit", function(ev){
      ev.preventDefault();
      grecaptcha.ready(function() {
        grecaptcha.execute(SITE_KEY, {action: 'submit'}).then(function(token) {
          document.getElementById("recaptcha-token").value = token;
          form.submit();            // hidden iframe にPOST
          statusEl.className = "status ok";
          statusEl.textContent = dict[getLang()].sent;
          form.reset();
        }).catch(function(){
          statusEl.className = "status err";
          statusEl.textContent = dict[getLang()].fail;
        });
      });
    });

    // ====== Q&A: JSONP load ======
    window.onQALoad = function(res){
      const box = document.getElementById("qa-list");
      box.innerHTML = "";
      if(!res || !res.ok){
        box.textContent = "Failed to load.";
        box.classList.add("qa-empty");
        return;
      }
      if(!res.items || !res.items.length){
        box.textContent = getLang()==="ja" ? "公開中のQ&Aはまだありません。" : "No published Q&A yet.";
        box.classList.add("qa-empty");
        return;
      }
      res.items.forEach(it=>{
        const el = document.createElement("div");
        el.className = "qa-item";
        el.innerHTML = `
          <h3 class="qa-title">${escapeHtml(it.title || (getLang()==="ja" ? "件名なし" : "No title"))}</h3>
          <div class="qa-meta">${escapeHtml(it.createdAt || "")} ・ ${escapeHtml(it.nameMasked || "")}</div>
          <p class="qa-q"><strong>Q.</strong> ${escapeHtml(it.question || "")}</p>
          <p class="qa-a"><strong>A.</strong> ${escapeHtml(it.answer || "")}</p>
        `;
        box.appendChild(el);
      });
    };
    function loadQA(){
      const s = document.createElement("script");
      s.src = `${EXEC_URL}?mode=qa&callback=onQALoad`;
      s.onerror = ()=>{ const b=document.getElementById("qa-list"); b.textContent="Failed to load."; b.classList.add("qa-empty"); };
      document.body.appendChild(s);
    }
    function escapeHtml(s){ return String(s||"").replace(/[&<>"']/g,c=>({ "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;" }[c])); }
    document.addEventListener("DOMContentLoaded", loadQA);
  </script>
</body>
</html>
