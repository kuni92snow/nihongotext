<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>News & Blog | nihongotext.com</title>
<link rel="preconnect" href="https://www.google.com" />
<link rel="preconnect" href="https://www.gstatic.com" />
<style>
  :root{--bg:#f7f7f7;--card:#fff;--fg:#222;--muted:#777;--ok:#e7f7ed;--oktxt:#217a3c;--err:#fbe9e9;--errtxt:#b00020;--border:#e5e5e5}
  body{margin:0;background:var(--bg);color:var(--fg);font:16px/1.6 -apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,"Hiragino Kaku Gothic ProN","Yu Gothic",Meiryo,sans-serif}
  .wrap{max-width:980px;margin:24px auto;padding:0 16px}
  h1{font-size:28px;margin:0 0 20px}
  .langbar{display:flex;gap:8px;margin-bottom:16px}
  .pill{border:1px solid var(--border);background:#fff;padding:6px 10px;border-radius:9999px;cursor:pointer}
  .pill.on{background:#111;color:#fff;border-color:#111}
  .grid{display:grid;grid-template-columns:1fr 1fr;gap:18px}
  @media (max-width:900px){.grid{grid-template-columns:1fr}}
  .card{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:16px}
  .card h2{margin:0 0 12px;font-size:18px}
  label{display:block;font-size:12px;color:var(--muted);margin:8px 0 4px}
  input,textarea{width:100%;box-sizing:border-box;border:1px solid var(--border);border-radius:10px;padding:10px 12px;font:inherit;background:#fff}
  textarea{min-height:140px;resize:vertical}
  .row{display:flex;gap:8px;margin-top:12px}
  .btn{appearance:none;border:1px solid var(--border);background:#fff;border-radius:10px;padding:8px 14px;cursor:pointer}
  .btn.primary{background:#111;color:#fff;border-color:#111}
  .msg-ok,.msg-ng{margin-top:10px;font-size:14px;border-radius:10px;padding:10px 12px;display:none}
  .msg-ok{background:var(--ok);color:var(--oktxt)}
  .msg-ng{background:var(--err);color:var(--errtxt)}
  .qa-item{border:1px solid var(--border);border-radius:12px;padding:12px 14px;margin:10px 0;background:#fff}
  .qa-q{font-weight:600;margin:0 0 8px}
  .qa-a{background:var(--ok);color:var(--oktxt);border-radius:8px;padding:10px;margin:0}
  small.muted{color:var(--muted)}
</style>
<script src="https://www.google.com/recaptcha/api.js" async defer></script>
</head>
<body>
  <div class="wrap">
    <h1>News & Blog</h1>

    <div class="langbar">
      <button id="btnJa" class="pill on">日本語</button>
      <button id="btnEn" class="pill">English</button>
    </div>

    <div class="grid">
      <section class="card">
        <h2 id="t_contact">お問い合わせ</h2>
        <form id="f" novalidate>
          <label id="t_name_l">お名前 / Name</label>
          <input id="name" autocomplete="name" />

          <label id="t_email_l">メール / Email</label>
          <input id="email" type="email" autocomplete="email" />

          <label id="t_subject_l">件名 / Subject</label>
          <input id="subject" />

          <label id="t_message_l">メッセージ / Message</label>
          <textarea id="message"></textarea>

          <div style="margin-top:10px">
            <div class="g-recaptcha" data-sitekey="6LcRKvArAAAAAFVmY21y9o_hwTszHwzp3bgRXtBV"></div>
          </div>

          <div class="row">
            <button type="button" class="btn" id="btnCancel">キャンセル</button>
            <button type="submit" class="btn primary" id="btnSend">送信</button>
          </div>

          <div id="ok"  class="msg-ok"></div>
          <div id="ng"  class="msg-ng"></div>
          <small class="muted" id="t_recaptcha_note">reCAPTCHA と Google の <a href="https://policies.google.com/privacy?hl=ja" target="_blank" rel="noopener">プライバシー ポリシー</a> と <a href="https://policies.google.com/terms?hl=ja" target="_blank" rel="noopener">利用規約</a> が適用されます。</small>
        </form>
      </section>

      <section class="card">
        <h2>Q&amp;A</h2>
        <small class="muted" id="qaStatus">読み込みに失敗しました。</small>
        <div id="qa"></div>
      </section>
    </div>
  </div>

<script>
/* ====== 設定（ここを環境に合わせて変更） ====== */
// ★ 最新の GAS JSONP エンドポイント（/exec）
const EXEC_JSONP_BASE = "https://script.google.com/macros/s/AKfycbyHEEBz5zMMi_9ilE5n5i88Kdilx0nYlGBOQXZy2TWhTQUZRxULVGTCygdh0JiJqaEdKg/exec";

/* ====== i18n ====== */
const T = {
  ja: {
    contact:"お問い合わせ", name_l:"お名前 / Name", email_l:"メール / Email",
    subject_l:"件名 / Subject", message_l:"メッセージ / Message",
    cancel:"キャンセル", send:"送信",
    ok:"送信しました。ありがとうございました。",
    ng:"送信に失敗しました。時間をおいて再度お試しください。",
    recaptcha_note:'reCAPTCHA と Google の <a href="https://policies.google.com/privacy?hl=ja" target="_blank" rel="noopener">プライバシー ポリシー</a> と <a href="https://policies.google.com/terms?hl=ja" target="_blank" rel="noopener">利用規約</a> が適用されます。',
    qa_failed:"読み込みに失敗しました。"
  },
  en: {
    contact:"Contact", name_l:"Name", email_l:"Email",
    subject_l:"Subject", message_l:"Message",
    cancel:"Cancel", send:"Send",
    ok:"Your message has been sent. Thank you!",
    ng:"Failed to send. Please try again later.",
    recaptcha_note:'This site is protected by reCAPTCHA and the Google <a href="https://policies.google.com/privacy" target="_blank" rel="noopener">Privacy Policy</a> and <a href="https://policies.google.com/terms" target="_blank" rel="noopener">Terms of Service</a> apply.',
    qa_failed:"Failed to load."
  }
};
let LANG = (new URL(location.href)).searchParams.get("lang")==="en" ? "en":"ja";
const $ = sel => document.querySelector(sel);

/* ====== UI 初期化 ====== */
function applyLang(){
  const t = T[LANG];
  $("#t_contact").textContent = t.contact;
  $("#t_name_l").textContent = t.name_l;
  $("#t_email_l").textContent = t.email_l;
  $("#t_subject_l").textContent = t.subject_l;
  $("#t_message_l").textContent = t.message_l;
  $("#btnCancel").textContent = t.cancel;
  $("#btnSend").textContent = t.send;
  $("#t_recaptcha_note").innerHTML = t.recaptcha_note;
  $("#qaStatus").textContent = t.qa_failed;
  // pill
  $("#btnJa").classList.toggle("on", LANG==="ja");
  $("#btnEn").classList.toggle("on", LANG==="en");
}
$("#btnJa").onclick = ()=> { LANG="ja"; history.replaceState(null,"",location.pathname+"?lang=ja"); applyLang(); };
$("#btnEn").onclick = ()=> { LANG="en"; history.replaceState(null,"",location.pathname+"?lang=en"); applyLang(); };
applyLang();

/* ====== Q&A（JSONP） ====== */
const QA_FALLBACK = [
  {
    title:"問い合わせについて",
    question:"かならず返答していただけますか？",
    answer:"できる限り返信はします。ただし、「確認しました。」のみの返信となる場合もあります。ご了承下さい。"
  },
  {
    title:"音声について",
    question:"音声の実装予定はありますか？",
    answer:"あります。ただし、公開時期は未定です。"
  }
];

function renderQA(items){
  const box = $("#qa");
  box.innerHTML = "";
  items.forEach(it=>{
    const div = document.createElement("div");
    div.className = "qa-item";
    div.innerHTML = `
      <div class="qa-q">${escapeHtml(it.title || "")}</div>
      <p class="qa-q">Q. ${escapeHtml(it.question || "")}</p>
      <p class="qa-a">A. ${escapeHtml(it.answer || "")}</p>
    `;
    box.appendChild(div);
  });
}

function loadQA(){
  // JSONP callback
  const cb = "qaCallback_"+Date.now();
  window[cb] = (res)=>{
    try{
      if(res && res.ok && Array.isArray(res.items) && res.items.length){
        $("#qaStatus").textContent = "";
        renderQA(res.items);
      }else{
        $("#qaStatus").textContent = T[LANG].qa_failed;
        renderQA(QA_FALLBACK);
      }
    }finally{
      cleanup();
    }
  };
  const s = document.createElement("script");
  s.src = `${EXEC_JSONP_BASE}?mode=qa&callback=${cb}`;
  s.onerror = ()=>{
    $("#qaStatus").textContent = T[LANG].qa_failed;
    renderQA(QA_FALLBACK);
    cleanup();
  };
  document.head.appendChild(s);
  function cleanup(){ delete window[cb]; s.remove(); }
}
loadQA();

/* ====== 問い合わせ送信（JSONP & reCAPTCHA） ====== */
$("#btnCancel").onclick = ()=>{
  $("#name").value = $("#email").value = $("#subject").value = $("#message").value = "";
  try{ grecaptcha.reset(); }catch(_){}
  $("#ok").style.display="none"; $("#ng").style.display="none";
};

$("#f").addEventListener("submit", (ev)=>{
  ev.preventDefault();
  $("#ok").style.display="none"; $("#ng").style.display="none";
  let token = "";
  try{ token = grecaptcha.getResponse(); }catch(_){}
  if(!token){
    showNg(LANG==="en" ? "Please check reCAPTCHA." : "reCAPTCHA をチェックしてください。");
    return;
  }
  const q = new URLSearchParams({
    mode:"contact_submit",
    name: $("#name").value || "",
    email: $("#email").value || "",
    subject: $("#subject").value || "",
    message: $("#message").value || "",
    token
  });
  const cb = "contactCb_"+Date.now();
  window[cb] = (res)=>{
    try{
      if(res && res.ok){
        showOk(T[LANG].ok);
        $("#f").reset();
        try{ grecaptcha.reset(); }catch(_){}
      }else{
        showNg(T[LANG].ng);
      }
    }finally{ cleanup(); }
  };
  const s = document.createElement("script");
  s.src = `${EXEC_JSONP_BASE}?${q.toString()}&callback=${cb}`;
  s.onerror = ()=>{ showNg(T[LANG].ng); cleanup(); };
  document.head.appendChild(s);
  function cleanup(){ delete window[cb]; s.remove(); }
});

function showOk(msg){ const el=$("#ok"); el.textContent=msg; el.style.display="block"; }
function showNg(msg){ const el=$("#ng"); el.textContent=msg; el.style.display="block"; }

/* ====== util ====== */
function escapeHtml(s){
  return String(s||"").replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));
}
</script>
</body>
</html>
